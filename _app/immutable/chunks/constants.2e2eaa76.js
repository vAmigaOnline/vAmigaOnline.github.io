var dr=Object.defineProperty;var vr=(e,t,n)=>t in e?dr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var re=(e,t,n)=>(vr(e,typeof t!="symbol"?t+"":t,n),n);import{w as l}from"./index.68d50c7e.js";var pr=(e=>(e.WARP_MODE="WARP_MODE",e.THEME="THEME",e.CANVAS_BORDER="CANVAS_BORDER",e.SHAKING="SHAKING",e.CPU_REVISION="CPU_REVISION",e.CPU_SPEED="CPU_SPEED",e.AGNUS_REVISION="AGNUS_REVISION",e.DENISE_REVISION="DENISE_REVISION",e.RTC_MODEL="RTC_MODEL",e.CHIP_RAM="CHIP_RAM",e.SLOW_RAM="SLOW_RAM",e.FAST_RAM="FAST_RAM",e.BANK_MAP="BANK_MAP",e.INIT_PATTERN="INIT_PATTERN",e.UNMAPPED="UNMAPPED",e.SLOW_RAM_MIRROR="SLOW_RAM_MIRROR",e.SLOW_RAM_DELAY="SLOW_RAM_DELAY",e.DF0="DF0",e.DF1="DF1",e.DF2="DF2",e.DF3="DF3",e.BLIITTER_ACCURACY="BLIITTER_ACCURACY",e.TODBUG="TODBUG",e.PTR_DROPS="PTR_DROPS",e.ECLOCK_SYNCING="ECLOCK_SYNCING",e.DRIVE_SPEED="DRIVE_SPEED",e.DRIVE_MECHANICS="DRIVE_MECHANICS",e.OPT_LOCK_DSKSYNC="OPT_LOCK_DSKSYNC",e.OPT_AUTO_DSKSYNC="OPT_AUTO_DSKSYNC",e.CLX_SPR_SPR="CLX_SPR_SPR",e.CLX_SPR_PLF="CLX_SPR_PLF",e.CLX_PLF_PLF="CLX_PLF_PLF",e.ACCURATE_KEYBOARD="ACCURATE_KEYBOARD",e.AUDVOL0="AUDVOL0",e.AUDVOL1="AUDVOL1",e.AUDVOL2="AUDVOL2",e.AUDVOL3="AUDVOL3",e.AUDVOLL="AUDVOLL",e.AUDVOLR="AUDVOLR",e.STEP_VOLUME="STEP_VOLUME",e.POLL_VOLUME="POLL_VOLUME",e.INSERT_VOLUME="INSERT_VOLUME",e.EJECT_VOLUME="EJECT_VOLUME",e.RENDER_MODE="RENDER_MODE",e.FLICKER_WEIGHT="FLICKER_WEIGHT",e.PALETTE="PALETTE",e.BRIGHTNESS="BRIGHTNESS",e.CONTRAST="CONTRAST",e.SATURATION="SATURATION",e))(pr||{}),yr=(e=>(e[e.none=0]="none",e[e.mouse=1]="mouse",e[e.keyset1=2]="keyset1",e[e.keyset2=3]="keyset2",e))(yr||{}),In=(e=>(e[e.none=0]="none",e[e.dropzone=1]="dropzone",e[e.kickstart=2]="kickstart",e[e.settings=3]="settings",e[e.shell=4]="shell",e[e.showcases=5]="showcases",e))(In||{}),gr=(e=>(e[e.smooth=0]="smooth",e[e.pixelated=1]="pixelated",e))(gr||{}),mr=(e=>(e[e.default=0]="default",e[e.light=1]="light",e[e.dark=2]="dark",e[e.coffee=3]="coffee",e[e.cupcake=4]="cupcake",e[e.forest=5]="forest",e[e.aqua=6]="aqua",e[e.garden=7]="garden",e[e.pastel=8]="pastel",e))(mr||{}),_r=(e=>(e[e.auto=0]="auto",e[e.never=1]="never",e[e.always=2]="always",e))(_r||{});class br{constructor(t,n){re(this,"title","");re(this,"tag",0);re(this,"isEnabled",!0);re(this,"isHidden",!1);re(this,"isSelected",!1);re(this,"isSeparator",!1);this.title=t,this.tag=n}}class Zi extends br{constructor(){super("",0)}}const ea=l(),ta=l(!1),na=l(),ra=l(),ia=l(),aa=l(),oa=l(),sa=l(),ua=l(),ca=l(),la=l(),fa=l(),ha=l(),da=l(),va=l(),pa=l(),ya=l(),ga=l(),ma=l(),_a=l(),ba=l(),wa=l(),Ea=l(!0),Sa=l("invert"),Aa=l(1),Da=l(0),Ca=l(),Ma=l(),Ra=l(0),xa=l(0),Ka=l(0),Pa=l(0),ka=l("fit"),Ta=l(!1),Ia=l(In.none),Oa=l(null),Ba=l(!1),Fa=l(!1),Na=l(!1),La=l(!1),Ua=l(!1),Va=l(!1),ja=l(!1),Ha=l([!1,!1,!1,!1]),Wa=l([!1,!1,!1,!1]),Ya=l([!1,!1,!1,!1]),za=l([!1,!1,!1,!1]),Ga=l([!1,!1,!1,!1]),Xa=l([!1,!1,!1,!1]),Qa=l([0,0,0,0]),qa=l([]),Ja=l(0),$a=l(0),Za=l(""),eo=l(0),to=l(0),no=l(0),ro=l(0),io=l(0),ao=l(0),oo=l(0),so=l(0),uo=l(0),co=l(0),lo=l(0),fo=l(0),ho=l(0),vo=l(0),po=l(0),yo=l(0),go=l(0),mo=l(0),_o=l(0),bo=l(0),wo=l(0),Eo=l(0),So=l(0),Ao=l(0),Do=l(0),Co=l(0),Mo=l(0),Ro=l(0),xo=l(0),Ko=l(0),Po=l(0),ko=l(0),To=l(0),Io=l(0),Oo=l(0),Bo=l(0),Fo=l(0),No=l(0),Lo=l(0),Uo=l(0),Vo=l(0),jo=l(0),Ho=l(0),Wo=l(0),Yo=l(0),zo=l(0),Go=l(0),Xo=l(0),Qo=l(0),qo=l(0),Jo=l(0),$o=l(0),Zo=l(0),es=l(0),ts=l(0),ns=l(0),rs=l(0),is=l(0),as=l(0),os=l(0),ss=l(0),us=l(0),cs=l(0),ls=l(0),fs=l(0),hs=l(0),ds=l(0),vs=l(0),ps=l(0),ys=l(0),gs=l(0),ms=l(0),_s=l(0),bs=l(0),ws=l(0),Es=l(0),Ss=l(0),As=l(0),Ds=l(0),Cs=l(0),Ms=l(0);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var k=function(){return k=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},k.apply(this,arguments)};function Tt(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var F=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,L=Object.keys,H=Array.isArray;typeof Promise<"u"&&!F.Promise&&(F.Promise=Promise);function Y(e,t){return typeof t!="object"||L(t).forEach(function(n){e[n]=t[n]}),e}var Ve=Object.getPrototypeOf,wr={}.hasOwnProperty;function G(e,t){return wr.call(e,t)}function Ke(e,t){typeof t=="function"&&(t=t(Ve(e))),(typeof Reflect>"u"?L:Reflect.ownKeys)(t).forEach(function(n){ce(e,n,t[n])})}var On=Object.defineProperty;function ce(e,t,n,r){On(e,t,Y(n&&G(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Pe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ce(e.prototype,"constructor",e),{extend:Ke.bind(null,e.prototype)}}}}var Er=Object.getOwnPropertyDescriptor;function rn(e,t){var n=Er(e,t),r;return n||(r=Ve(e))&&rn(r,t)}var Sr=[].slice;function Et(e,t,n){return Sr.call(e,t,n)}function Bn(e,t){return t(e)}function Be(e){if(!e)throw new Error("Assertion Failed")}function Fn(e){F.setImmediate?setImmediate(e):setTimeout(e,0)}function Nn(e,t){return e.reduce(function(n,r,i){var a=t(r,i);return a&&(n[a[0]]=a[1]),n},{})}function Ar(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}function ue(e,t){if(G(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=ue(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(o!==-1){var s=e[t.substr(0,o)];return s===void 0?void 0:ue(s,t.substr(o+1))}}function $(e,t,n){if(!(!e||t===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Be(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)$(e,t[r],n[r])}else{var a=t.indexOf(".");if(a!==-1){var o=t.substr(0,a),s=t.substr(a+1);if(s==="")n===void 0?H(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var u=e[o];(!u||!G(e,o))&&(u=e[o]={}),$(u,s,n)}}else n===void 0?H(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Dr(e,t){typeof t=="string"?$(e,t,void 0):"length"in t&&[].map.call(t,function(n){$(e,n,void 0)})}function Ln(e){var t={};for(var n in e)G(e,n)&&(t[n]=e[n]);return t}var Cr=[].concat;function Un(e){return Cr.apply([],e)}var Vn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Un([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return F[e]}),Mr=Vn.map(function(e){return F[e]});Nn(Vn,function(e){return[e,!0]});var ve=null;function Xe(e){ve=typeof WeakMap<"u"&&new WeakMap;var t=It(e);return ve=null,t}function It(e){if(!e||typeof e!="object")return e;var t=ve&&ve.get(e);if(t)return t;if(H(e)){t=[],ve&&ve.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(It(e[n]))}else if(Mr.indexOf(e.constructor)>=0)t=e;else{var i=Ve(e);t=i===Object.prototype?{}:Object.create(i),ve&&ve.set(e,t);for(var a in e)G(e,a)&&(t[a]=It(e[a]))}return t}var Rr={}.toString;function Ot(e){return Rr.call(e).slice(8,-1)}var Bt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",xr=typeof Bt=="symbol"?function(e){var t;return e!=null&&(t=e[Bt])&&t.apply(e)}:function(){return null},Re={};function oe(e){var t,n,r,i;if(arguments.length===1){if(H(e))return e.slice();if(this===Re&&typeof e=="string")return[e];if(i=xr(e)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(e==null)return[e];if(t=e.length,typeof t=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var an=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ne=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function jn(e,t){ne=e,Hn=t}var Hn=function(){return!0},Kr=!new Error("").stack;function De(){if(Kr)try{throw De.arguments,new Error}catch(e){return e}return new Error}function Ft(e,t){var n=e.stack;return n?(t=t||0,n.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),n.split(`
`).slice(t).filter(Hn).map(function(r){return`
`+r}).join("")):""}var Pr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Wn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],on=Pr.concat(Wn),kr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ke(e,t){this._e=De(),this.name=e,this.message=t}Pe(ke).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ft(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Yn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function dt(e,t,n,r){this._e=De(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Yn(e,t)}Pe(dt).from(ke);function Ne(e,t){this._e=De(),this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Yn(e,t)}Pe(Ne).from(ke);var sn=on.reduce(function(e,t){return e[t]=t+"Error",e},{}),Tr=ke,x=on.reduce(function(e,t){var n=t+"Error";function r(i,a){this._e=De(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=kr[t]||n,this.inner=null)}return Pe(r).from(Tr),e[t]=r,e},{});x.Syntax=SyntaxError;x.Type=TypeError;x.Range=RangeError;var wn=Wn.reduce(function(e,t){return e[t+"Error"]=x[t],e},{});function Ir(e,t){if(!e||e instanceof ke||e instanceof TypeError||e instanceof SyntaxError||!e.name||!wn[e.name])return e;var n=new wn[e.name](t||e.message,e);return"stack"in e&&ce(n,"stack",{get:function(){return this.inner.stack}}),n}var St=on.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=x[t]),e},{});St.ModifyError=dt;St.DexieError=ke;St.BulkError=Ne;function B(){}function Qe(e){return e}function Or(e,t){return e==null||e===Qe?t:function(n){return t(e(n))}}function Se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Br(e,t){return e===B?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Se(i,this.onerror):i),a!==void 0?a:n}}function Fr(e,t){return e===B?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Se(r,this.onerror):r)}}function Nr(e,t){return e===B?t:function(n){var r=e.apply(this,arguments);Y(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Se(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Se(a,this.onerror):a),r===void 0?o===void 0?void 0:o:Y(r,o)}}function Lr(e,t){return e===B?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function un(e,t){return e===B?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}var je={},Ur=100,Vr=20,zn=100,cn=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Ve(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Ve(t),e]}(),Nt=cn[0],vt=cn[1],Lt=cn[2],Gn=vt&&vt.then,st=Nt&&Nt.constructor,ln=!!Lt,Ut=!1,jr=Lt?function(){Lt.then(tt)}:F.setImmediate?setImmediate.bind(null,tt):F.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){tt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(tt,0)},He=function(e,t){Fe.push([e,t]),pt&&(jr(),pt=!1)},Vt=!0,pt=!0,we=[],ut=[],jt=null,Ht=Qe,xe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:An,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{An(e[0],e[1])}catch{}})}},C=xe,Fe=[],Ee=0,ct=[];function D(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=B,this._lib=!1;var t=this._PSD=C;if(ne&&(this._stackHolder=De(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==je)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Yt(this,this._value);return}this._state=null,this._value=null,++t.ref,Qn(this,e)}var Wt={get:function(){var e=C,t=yt;function n(r,i){var a=this,o=!e.global&&(e!==C||t!==yt),s=o&&!le(),u=new D(function(c,h){fn(a,new Xn(mt(r,e,o,s),mt(i,e,o,s),c,h,e))});return ne&&$n(u,this),u}return n.prototype=je,n},set:function(e){ce(this,"then",e&&e.prototype===je?Wt:{get:function(){return e},set:Wt.set})}};Ke(D.prototype,{then:Wt,_then:function(e,t){fn(this,new Xn(null,null,e,t,C))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,function(r){return r instanceof t?n(r):lt(r)}):this.then(null,function(r){return r&&r.name===t?n(r):lt(r)})},finally:function(e){return this.then(function(t){return e(),t},function(t){return e(),lt(t)})},stack:{get:function(){if(this._stack)return this._stack;try{Ut=!0;var e=Jn(this,[],Vr),t=e.join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Ut=!1}}},timeout:function(e,t){var n=this;return e<1/0?new D(function(r,i){var a=setTimeout(function(){return i(new x.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&ce(D.prototype,Symbol.toStringTag,"Dexie.Promise");xe.env=Zn();function Xn(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}Ke(D,{all:function(){var e=oe.apply(null,arguments).map(gt);return new D(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return D.resolve(i).then(function(o){e[a]=o,--r||t(e)},n)})})},resolve:function(e){if(e instanceof D)return e;if(e&&typeof e.then=="function")return new D(function(n,r){e.then(n,r)});var t=new D(je,!0,e);return $n(t,jt),t},reject:lt,race:function(){var e=oe.apply(null,arguments).map(gt);return new D(function(t,n){e.map(function(r){return D.resolve(r).then(t,n)})})},PSD:{get:function(){return C},set:function(e){return C=e}},totalEchoes:{get:function(){return yt}},newPSD:ye,usePSD:Ie,scheduler:{get:function(){return He},set:function(e){He=e}},rejectionMapper:{get:function(){return Ht},set:function(e){Ht=e}},follow:function(e,t){return new D(function(n,r){return ye(function(i,a){var o=C;o.unhandleds=[],o.onunhandled=a,o.finalize=Se(function(){var s=this;Wr(function(){s.unhandleds.length===0?i():a(s.unhandleds[0])})},o.finalize),e()},t,n,r)})}});st&&(st.allSettled&&ce(D,"allSettled",function(){var e=oe.apply(null,arguments).map(gt);return new D(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return D.resolve(i).then(function(o){return r[a]={status:"fulfilled",value:o}},function(o){return r[a]={status:"rejected",reason:o}}).then(function(){return--n||t(r)})})})}),st.any&&typeof AggregateError<"u"&&ce(D,"any",function(){var e=oe.apply(null,arguments).map(gt);return new D(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,o){return D.resolve(a).then(function(s){return t(s)},function(s){i[o]=s,--r||n(new AggregateError(i))})})})}));function Qn(e,t){try{t(function(n){if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&qe();n&&typeof n.then=="function"?Qn(e,function(i,a){n instanceof D?n._then(i,a):n.then(i,a)}):(e._state=!0,e._value=n,qn(e)),r&&Je()}},Yt.bind(null,e))}catch(n){Yt(e,n)}}function Yt(e,t){if(ut.push(t),e._state===null){var n=e._lib&&qe();t=Ht(t),e._state=!1,e._value=t,ne&&t!==null&&typeof t=="object"&&!t._promise&&Ar(function(){var r=rn(t,"stack");t._promise=e,ce(t,"stack",{get:function(){return Ut?r&&(r.get?r.get.apply(t):r.value):e.stack}})}),Yr(e),qn(e),n&&Je()}}function qn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)fn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Ee===0&&(++Ee,He(function(){--Ee===0&&hn()},[]))}function fn(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ee,He(Hr,[n,e,t])}function Hr(e,t,n){try{jt=t;var r,i=t._value;t._state?r=e(i):(ut.length&&(ut=[]),r=e(i),ut.indexOf(i)===-1&&zr(t)),n.resolve(r)}catch(a){n.reject(a)}finally{jt=null,--Ee===0&&hn(),--n.psd.ref||n.psd.finalize()}}function Jn(e,t,n){if(t.length===n)return t;var r="";if(e._state===!1){var i=e._value,a,o;i!=null?(a=i.name||"Error",o=i.message||i,r=Ft(i,0)):(a=i,o=""),t.push(a+(o?": "+o:"")+r)}return ne&&(r=Ft(e._stackHolder,2),r&&t.indexOf(r)===-1&&t.push(r),e._prev&&Jn(e._prev,t,n)),t}function $n(e,t){var n=t?t._numPrev+1:0;n<Ur&&(e._prev=t,e._numPrev=n)}function tt(){qe()&&Je()}function qe(){var e=Vt;return Vt=!1,pt=!1,e}function Je(){var e,t,n;do for(;Fe.length>0;)for(e=Fe,Fe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Fe.length>0);Vt=!0,pt=!0}function hn(){var e=we;we=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=ct.slice(0),n=t.length;n;)t[--n]()}function Wr(e){function t(){e(),ct.splice(ct.indexOf(t),1)}ct.push(t),++Ee,He(function(){--Ee===0&&hn()},[])}function Yr(e){we.some(function(t){return t._value===e._value})||we.push(e)}function zr(e){for(var t=we.length;t;)if(we[--t]._value===e._value){we.splice(t,1);return}}function lt(e){return new D(je,!1,e)}function N(e,t){var n=C;return function(){var r=qe(),i=C;try{return ge(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{ge(i,!1),r&&Je()}}}var j={awaits:0,echoes:0,id:0},Gr=0,ft=[],Ct=0,yt=0,Xr=0;function ye(e,t,n,r){var i=C,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Xr;var o=xe.env;a.env=ln?{Promise:D,PromiseProp:{value:D,configurable:!0,writable:!0},all:D.all,race:D.race,allSettled:D.allSettled,any:D.any,resolve:D.resolve,reject:D.reject,nthen:En(o.nthen,a),gthen:En(o.gthen,a)}:{},t&&Y(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=Ie(a,e,n,r);return a.ref===0&&a.finalize(),s}function Te(){return j.id||(j.id=++Gr),++j.awaits,j.echoes+=zn,j.id}function le(){return j.awaits?(--j.awaits===0&&(j.id=0),j.echoes=j.awaits*zn,!0):!1}(""+Gn).indexOf("[native code]")===-1&&(Te=le=B);function gt(e){return j.echoes&&e&&e.constructor===st?(Te(),e.then(function(t){return le(),t},function(t){return le(),U(t)})):e}function Qr(e){++yt,(!j.echoes||--j.echoes===0)&&(j.echoes=j.id=0),ft.push(C),ge(e,!0)}function qr(){var e=ft[ft.length-1];ft.pop(),ge(e,!1)}function ge(e,t){var n=C;if((t?j.echoes&&(!Ct++||e!==C):Ct&&(!--Ct||e!==C))&&er(t?Qr.bind(null,e):qr),e!==C&&(C=e,n===xe&&(xe.env=Zn()),ln)){var r=xe.env.Promise,i=e.env;vt.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(F,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Zn(){var e=F.Promise;return ln?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(F,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:vt.then,gthen:e.prototype.then}:{}}function Ie(e,t,n,r,i){var a=C;try{return ge(e,!0),t(n,r,i)}finally{ge(a,!1)}}function er(e){Gn.call(Nt,e)}function mt(e,t,n,r){return typeof e!="function"?e:function(){var i=C;n&&Te(),ge(t,!0);try{return e.apply(this,arguments)}finally{ge(i,!1),r&&er(le)}}}function En(e,t){return function(n,r){return e.call(this,mt(n,t),mt(r,t))}}var Sn="unhandledrejection";function An(e,t){var n;try{n=t.onuncatched(e)}catch{}if(n!==!1)try{var r,i={promise:t,reason:e};if(F.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Sn,!0,!0),Y(r,i)):F.CustomEvent&&(r=new CustomEvent(Sn,{detail:i}),Y(r,i)),r&&F.dispatchEvent&&(dispatchEvent(r),!F.PromiseRejectionEvent&&F.onunhandledrejection))try{F.onunhandledrejection(r)}catch{}ne&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch{}}var U=D.reject;function zt(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!C.letThrough&&!e._vip){if(e._state.openComplete)return U(new x.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return U(new x.DatabaseClosed);e.open().catch(B)}return e._state.dbReadyPromise.then(function(){return zt(e,t,n,r)})}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(a){return a.name===sn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return zt(e,t,n,r)})):U(a)}return i._promise(t,function(a,o){return ye(function(){return C.trans=i,r(a,o,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var Dn="3.2.3",be=String.fromCharCode(65535),Gt=-1/0,ie="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",tr="String expected.",Le=[],At=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Jr=At,$r=At,nr=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},Dt="__dbnames",Mt="readonly",Rt="readwrite";function Ae(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var rr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nt(e){return typeof e=="string"&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=Xe(t),delete t[e]),t}:function(t){return t}}var Zr=function(){function e(){}return e.prototype._trans=function(t,n,r){var i=this._tx||C.trans,a=this.name;function o(u,c,h){if(!h.schema[a])throw new x.NotFound("Table "+a+" not part of transaction");return n(h.idbtrans,h)}var s=qe();try{return i&&i.db===this.db?i===C.trans?i._promise(t,o,r):ye(function(){return i._promise(t,o,r)},{trans:i,transless:C.transless||C}):zt(this.db,t,[this.name],o)}finally{s&&Je()}},e.prototype.get=function(t,n){var r=this;return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:t}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},e.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(H(t))return new this.db.WhereClause(this,"["+t.join("+")+"]");var n=L(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){return h.compound&&n.every(function(f){return h.keyPath.indexOf(f)>=0})&&h.keyPath.every(function(f){return n.indexOf(f)>=0})})[0];if(r&&this.db._maxKey!==be)return this.where(r.name).equals(r.keyPath.map(function(h){return t[h]}));!r&&ne&&console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,a=this.db._deps.indexedDB;function o(h,f){try{return a.cmp(h,f)===0}catch{return!1}}var s=n.reduce(function(h,f){var v=h[0],b=h[1],p=i[f],d=t[f];return[v||p,v||!p?Ae(b,p&&p.multi?function(g){var w=ue(g,f);return H(w)&&w.some(function(E){return o(d,E)})}:function(g){return o(d,ue(g,f))}):b]},[null,null]),u=s[0],c=s[1];return u?this.where(u.name).equals(t[u.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")},e.prototype.filter=function(t){return this.toCollection().and(t)},e.prototype.count=function(t){return this.toCollection().count(t)},e.prototype.offset=function(t){return this.toCollection().offset(t)},e.prototype.limit=function(t){return this.toCollection().limit(t)},e.prototype.each=function(t){return this.toCollection().each(t)},e.prototype.toArray=function(t){return this.toCollection().toArray(t)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,H(t)?"["+t.join("+")+"]":t))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(t){this.schema.mappedClass=t;var n=function(r){if(!r)return r;var i=Object.create(t.prototype);for(var a in r)if(G(r,a))try{i[a]=r[a]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t},e.prototype.defineClass=function(){function t(n){Y(this,n)}return this.mapToClass(t)},e.prototype.add=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=t;return o&&a&&(s=nt(o)(t)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{$(t,o,u)}catch{}return u})},e.prototype.update=function(t,n){if(typeof t=="object"&&!H(t)){var r=ue(t,this.schema.primKey.keyPath);if(r===void 0)return U(new x.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?L(n).forEach(function(i){$(t,i,n[i])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(t).modify(n)},e.prototype.put=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=t;return o&&a&&(s=nt(o)(t)),this._trans("readwrite",function(u){return r.core.mutate({trans:u,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(u){return u.numFailures?D.reject(u.failures[0]):u.lastResult}).then(function(u){if(o)try{$(t,o,u)}catch{}return u})},e.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[t]})}).then(function(r){return r.numFailures?D.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"deleteRange",range:rr})}).then(function(n){return n.numFailures?D.reject(n.failures[0]):void 0})},e.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:t,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},e.prototype.bulkAdd=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,c=u.auto,h=u.keyPath;if(h&&a)throw new x.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new x.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,v=h&&c?t.map(nt(h)):t;return i.core.mutate({trans:s,type:"add",keys:a,values:v,wantResults:o}).then(function(b){var p=b.numFailures,d=b.results,g=b.lastResult,w=b.failures,E=o?d:g;if(p===0)return E;throw new Ne(i.name+".bulkAdd(): "+p+" of "+f+" operations failed",w)})})},e.prototype.bulkPut=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var u=i.schema.primKey,c=u.auto,h=u.keyPath;if(h&&a)throw new x.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new x.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,v=h&&c?t.map(nt(h)):t;return i.core.mutate({trans:s,type:"put",keys:a,values:v,wantResults:o}).then(function(b){var p=b.numFailures,d=b.results,g=b.lastResult,w=b.failures,E=o?d:g;if(p===0)return E;throw new Ne(i.name+".bulkPut(): "+p+" of "+f+" operations failed",w)})})},e.prototype.bulkDelete=function(t){var n=this,r=t.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:t})}).then(function(i){var a=i.numFailures,o=i.lastResult,s=i.failures;if(a===0)return o;throw new Ne(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",s)})},e}();function $e(e){var t={},n=function(s,u){if(u){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return t[s].subscribe.apply(null,h),e}else if(typeof s=="string")return t[s]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(s,u,c){if(typeof s=="object")return o(s);u||(u=Lr),c||(c=B);var h={subscribers:[],fire:c,subscribe:function(f){h.subscribers.indexOf(f)===-1&&(h.subscribers.push(f),h.fire=u(h.fire,f))},unsubscribe:function(f){h.subscribers=h.subscribers.filter(function(v){return v!==f}),h.fire=h.subscribers.reduce(u,c)}};return t[s]=n[s]=h,h}function o(s){L(s).forEach(function(u){var c=s[u];if(H(c))a(u,s[u][0],s[u][1]);else if(c==="asap")var h=a(u,Qe,function(){for(var v=arguments.length,b=new Array(v);v--;)b[v]=arguments[v];h.subscribers.forEach(function(p){Fn(function(){p.apply(null,b)})})});else throw new x.InvalidArgument("Invalid event config")})}}function Ze(e,t){return Pe(t).from({prototype:e}),t}function ei(e){return Ze(Zr.prototype,function(n,r,i){this.db=e,this._tx=i,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:$e(null,{creating:[Br,B],reading:[Or,Qe],updating:[Nr,B],deleting:[Fr,B]})})}function Ce(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function xt(e,t){e.filter=Ae(e.filter,t)}function Kt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ae(r(),t())}:t,e.justLimit=n&&!r}function ti(e,t){e.isMatch=Ae(e.isMatch,t)}function ht(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new x.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Cn(e,t,n){var r=ht(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function rt(e,t,n,r){var i=e.replayFilter?Ae(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(s,u,c){if(!i||i(u,c,function(v){return u.stop(v)},function(v){return u.fail(v)})){var h=u.primaryKey,f=""+h;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(h)),G(a,f)||(a[f]=!0,t(s,u,c))}};return Promise.all([e.or._iterate(o,n),Mn(Cn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}else return Mn(Cn(e,r,n),Ae(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Mn(e,t,n,r){var i=r?function(o,s,u){return n(r(o),s,u)}:n,a=N(i);return e.then(function(o){if(o)return o.start(function(){var s=function(){return o.continue()};(!t||t(o,function(u){return s=u},function(u){o.stop(u),s=B},function(u){o.fail(u),s=B}))&&a(o.value,o,function(u){return s=u}),s()})})}function W(e,t){try{var n=Rn(e),r=Rn(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return ri(xn(e),xn(t));case"Array":return ni(e,t)}}catch{}return NaN}function ni(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var o=W(e[a],t[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}function ri(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}function Rn(e){var t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";var n=Ot(e);return n==="ArrayBuffer"?"binary":n}function xn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var ii=function(){function e(){}return e.prototype._read=function(t,n){var r=this._ctx;return r.error?r.table._trans(null,U.bind(null,r.error)):r.table._trans("readonly",t).then(n)},e.prototype._write=function(t){var n=this._ctx;return n.error?n.table._trans(null,U.bind(null,n.error)):n.table._trans("readwrite",t,"locked")},e.prototype._addAlgorithm=function(t){var n=this._ctx;n.algorithm=Ae(n.algorithm,t)},e.prototype._iterate=function(t,n){return rt(this._ctx,t,n,this._ctx.table.core)},e.prototype.clone=function(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&Y(r,t),n._ctx=r,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(t){var n=this._ctx;return this._read(function(r){return rt(n,t,r,n.table.core)})},e.prototype.count=function(t){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(Ce(i,!0))return a.count({trans:r,query:{index:ht(i,a.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var o=0;return rt(i,function(){return++o,!1},r,a).then(function(){return o})}).then(t)},e.prototype.sortBy=function(t,n){var r=t.split(".").reverse(),i=r[0],a=r.length-1;function o(c,h){return h?o(c[r[h]],h-1):c[i]}var s=this._ctx.dir==="next"?1:-1;function u(c,h){var f=o(c,a),v=o(h,a);return f<v?-s:f>v?s:0}return this.toArray(function(c){return c.sort(u)}).then(n)},e.prototype.toArray=function(t){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&Ce(i,!0)&&i.limit>0){var a=i.valueMapper,o=ht(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(u){var c=u.result;return a?c.map(a):c})}else{var s=[];return rt(i,function(u){return s.push(u)},r,i.table.core).then(function(){return s})}},t)},e.prototype.offset=function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,Ce(n)?Kt(n,function(){var r=t;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Kt(n,function(){var r=t;return function(){return--r<0}}),this)},e.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Kt(this._ctx,function(){var n=t;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},e.prototype.until=function(t,n){return xt(this._ctx,function(r,i,a){return t(r.value)?(i(a),n):!0}),this},e.prototype.first=function(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)},e.prototype.last=function(t){return this.reverse().first(t)},e.prototype.filter=function(t){return xt(this._ctx,function(n){return t(n.value)}),ti(this._ctx,t),this},e.prototype.and=function(t){return this.filter(t)},e.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})},e.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},e.prototype.eachPrimaryKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})},e.prototype.keys=function(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(t)},e.prototype.primaryKeys=function(t){var n=this._ctx;if(n.dir==="next"&&Ce(n,!0)&&n.limit>0)return this._read(function(i){var a=ht(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(t)},e.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},e.prototype.firstKey=function(t){return this.limit(1).keys(function(n){return n[0]}).then(t)},e.prototype.lastKey=function(t){return this.reverse().firstKey(t)},e.prototype.distinct=function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return xt(this._ctx,function(i){var a=i.primaryKey.toString(),o=G(r,a);return r[a]=!0,!o}),this},e.prototype.modify=function(t){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof t=="function")a=t;else{var o=L(t),s=o.length;a=function(w){for(var E=!1,m=0;m<s;++m){var _=o[m],y=t[_];ue(w,_)!==y&&($(w,_,y),E=!0)}return E}}var u=r.table.core,c=u.schema.primaryKey,h=c.outbound,f=c.extractKey,v=n.db._options.modifyChunkSize||200,b=[],p=0,d=[],g=function(w,E){var m=E.failures,_=E.numFailures;p+=w-_;for(var y=0,S=L(m);y<S.length;y++){var M=S[y];b.push(m[M])}};return n.clone().primaryKeys().then(function(w){var E=function(m){var _=Math.min(v,w.length-m);return u.getMany({trans:i,keys:w.slice(m,m+_),cache:"immutable"}).then(function(y){for(var S=[],M=[],A=h?[]:null,R=[],K=0;K<_;++K){var I=y[K],O={value:Xe(I),primKey:w[m+K]};a.call(O,O.value,O)!==!1&&(O.value==null?R.push(w[m+K]):!h&&W(f(I),f(O.value))!==0?(R.push(w[m+K]),S.push(O.value)):(M.push(O.value),h&&A.push(w[m+K])))}var T=Ce(r)&&r.limit===1/0&&(typeof t!="function"||t===Pt)&&{index:r.index,range:r.range};return Promise.resolve(S.length>0&&u.mutate({trans:i,type:"add",values:S}).then(function(V){for(var P in V.failures)R.splice(parseInt(P),1);g(S.length,V)})).then(function(){return(M.length>0||T&&typeof t=="object")&&u.mutate({trans:i,type:"put",keys:A,values:M,criteria:T,changeSpec:typeof t!="function"&&t}).then(function(V){return g(M.length,V)})}).then(function(){return(R.length>0||T&&t===Pt)&&u.mutate({trans:i,type:"delete",keys:R,criteria:T}).then(function(V){return g(R.length,V)})}).then(function(){return w.length>m+_&&E(m+v)})})};return E(0).then(function(){if(b.length>0)throw new dt("Error modifying one or more objects",b,p,d);return w.length})})})},e.prototype.delete=function(){var t=this._ctx,n=t.range;return Ce(t)&&(t.isPrimKey&&!$r||n.type===3)?this._write(function(r){var i=t.table.core.schema.primaryKey,a=n;return t.table.core.count({trans:r,query:{index:i,range:a}}).then(function(o){return t.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(s){var u=s.failures;s.lastResult,s.results;var c=s.numFailures;if(c)throw new dt("Could not delete some values",Object.keys(u).map(function(h){return u[h]}),o-c);return o-c})})}):this.modify(Pt)},e}(),Pt=function(e,t){return t.value=null};function ai(e){return Ze(ii.prototype,function(n,r){this.db=e;var i=rr,a=null;if(r)try{i=r()}catch(c){a=c}var o=n._ctx,s=o.table,u=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:o.or,valueMapper:u!==Qe?u:null}})}function oi(e,t){return e<t?-1:e===t?0:1}function si(e,t){return e>t?-1:e===t?0:1}function z(e,t,n){var r=e instanceof ar?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Me(e){return new e.Collection(e,function(){return ir("")}).limit(0)}function ui(e){return e==="next"?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function ci(e){return e==="next"?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function li(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,u=0;u<o;++u){var c=t[u];if(c!==r[u])return i(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[u],c)<0&&(s=u)}return o<r.length&&a==="next"?e+n.substr(e.length):o<e.length&&a==="prev"?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function it(e,t,n,r){var i,a,o,s,u,c,h,f=n.length;if(!n.every(function(d){return typeof d=="string"}))return z(e,tr);function v(d){i=ui(d),a=ci(d),o=d==="next"?oi:si;var g=n.map(function(w){return{lower:a(w),upper:i(w)}}).sort(function(w,E){return o(w.lower,E.lower)});s=g.map(function(w){return w.upper}),u=g.map(function(w){return w.lower}),c=d,h=d==="next"?"":r}v("next");var b=new e.Collection(e,function(){return de(s[0],u[f-1]+r)});b._ondirectionchange=function(d){v(d)};var p=0;return b._addAlgorithm(function(d,g,w){var E=d.key;if(typeof E!="string")return!1;var m=a(E);if(t(m,u,p))return!0;for(var _=null,y=p;y<f;++y){var S=li(E,m,s[y],u[y],o,c);S===null&&_===null?p=y+1:(_===null||o(_,S)>0)&&(_=S)}return g(_!==null?function(){d.continue(_+h)}:w),!1}),b}function de(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ir(e){return{type:1,lower:e,upper:e}}var ar=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&!(r&&i)?Me(this):new this.Collection(this,function(){return de(t,n,!r,!i)})}catch{return z(this,ie)}},e.prototype.equals=function(t){return t==null?z(this,ie):new this.Collection(this,function(){return ir(t)})},e.prototype.above=function(t){return t==null?z(this,ie):new this.Collection(this,function(){return de(t,void 0,!0)})},e.prototype.aboveOrEqual=function(t){return t==null?z(this,ie):new this.Collection(this,function(){return de(t,void 0,!1)})},e.prototype.below=function(t){return t==null?z(this,ie):new this.Collection(this,function(){return de(void 0,t,!1,!0)})},e.prototype.belowOrEqual=function(t){return t==null?z(this,ie):new this.Collection(this,function(){return de(void 0,t)})},e.prototype.startsWith=function(t){return typeof t!="string"?z(this,tr):this.between(t,t+be,!0,!0)},e.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):it(this,function(n,r){return n.indexOf(r[0])===0},[t],be)},e.prototype.equalsIgnoreCase=function(t){return it(this,function(n,r){return n===r[0]},[t],"")},e.prototype.anyOfIgnoreCase=function(){var t=oe.apply(Re,arguments);return t.length===0?Me(this):it(this,function(n,r){return r.indexOf(n)!==-1},t,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var t=oe.apply(Re,arguments);return t.length===0?Me(this):it(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},t,be)},e.prototype.anyOf=function(){var t=this,n=oe.apply(Re,arguments),r=this._cmp;try{n.sort(r)}catch{return z(this,ie)}if(n.length===0)return Me(this);var i=new this.Collection(this,function(){return de(n[0],n[n.length-1])});i._ondirectionchange=function(o){r=o==="next"?t._ascending:t._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(o,s,u){for(var c=o.key;r(c,n[a])>0;)if(++a,a===n.length)return s(u),!1;return r(c,n[a])===0?!0:(s(function(){o.continue(n[a])}),!1)}),i},e.prototype.notEqual=function(t){return this.inAnyRange([[Gt,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var t=oe.apply(Re,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return z(this,ie)}var n=t.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Gt,i]]},null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(t,n){var r=this,i=this._cmp,a=this._ascending,o=this._descending,s=this._min,u=this._max;if(t.length===0)return Me(this);if(!t.every(function(y){return y[0]!==void 0&&y[1]!==void 0&&a(y[0],y[1])<=0}))return z(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",x.InvalidArgument);var c=!n||n.includeLowers!==!1,h=n&&n.includeUppers===!0;function f(y,S){for(var M=0,A=y.length;M<A;++M){var R=y[M];if(i(S[0],R[1])<0&&i(S[1],R[0])>0){R[0]=s(R[0],S[0]),R[1]=u(R[1],S[1]);break}}return M===A&&y.push(S),y}var v=a;function b(y,S){return v(y[0],S[0])}var p;try{p=t.reduce(f,[]),p.sort(b)}catch{return z(this,ie)}var d=0,g=h?function(y){return a(y,p[d][1])>0}:function(y){return a(y,p[d][1])>=0},w=c?function(y){return o(y,p[d][0])>0}:function(y){return o(y,p[d][0])>=0};function E(y){return!g(y)&&!w(y)}var m=g,_=new this.Collection(this,function(){return de(p[0][0],p[p.length-1][1],!c,!h)});return _._ondirectionchange=function(y){y==="next"?(m=g,v=a):(m=w,v=o),p.sort(b)},_._addAlgorithm(function(y,S,M){for(var A=y.key;m(A);)if(++d,d===p.length)return S(M),!1;return E(A)?!0:(r._cmp(A,p[d][1])===0||r._cmp(A,p[d][0])===0||S(function(){v===a?y.continue(p[d][0]):y.continue(p[d][1])}),!1)}),_},e.prototype.startsWithAnyOf=function(){var t=oe.apply(Re,arguments);return t.every(function(n){return typeof n=="string"})?t.length===0?Me(this):this.inAnyRange(t.map(function(n){return[n,n+be]})):z(this,"startsWithAnyOf() only works with strings")},e}();function fi(e){return Ze(ar.prototype,function(n,r,i){this.db=e,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=e._deps.indexedDB;if(!a)throw new x.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(o,s){return a.cmp(s,o)},this._max=function(o,s){return a.cmp(o,s)>0?o:s},this._min=function(o,s){return a.cmp(o,s)<0?o:s},this._IDBKeyRange=e._deps.IDBKeyRange})}function te(e){return N(function(t){return We(t),e(t.target.error),!1})}function We(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Ye="storagemutated",pe="x-storagemutated-1",me=$e(null,Ye),hi=function(){function e(){}return e.prototype._lock=function(){return Be(!C.global),++this._reculock,this._reculock===1&&!C.global&&(C.lockOwnerFor=this),this},e.prototype._unlock=function(){if(Be(!C.global),--this._reculock===0)for(C.global||(C.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Ie(t[1],t[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&C.lockOwnerFor!==this},e.prototype.create=function(t){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Be(!this.idbtrans),!t&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new x.DatabaseClosed(i);case"MissingAPIError":throw new x.MissingAPI(i.message,i);default:throw new x.OpenFailed(i)}if(!this.active)throw new x.TransactionInactive;return Be(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=N(function(a){We(a),n._reject(t.error)}),t.onabort=N(function(a){We(a),n.active&&n._reject(new x.Abort(t.error)),n.active=!1,n.on("abort").fire(a)}),t.oncomplete=N(function(){n.active=!1,n._resolve(),"mutatedParts"in t&&me.storagemutated.fire(t.mutatedParts)}),this},e.prototype._promise=function(t,n,r){var i=this;if(t==="readwrite"&&this.mode!=="readwrite")return U(new x.ReadOnly("Transaction is readonly"));if(!this.active)return U(new x.TransactionInactive);if(this._locked())return new D(function(o,s){i._blockedFuncs.push([function(){i._promise(t,n,r).then(o,s)},C])});if(r)return ye(function(){var o=new D(function(s,u){i._lock();var c=n(s,u,i);c&&c.then&&c.then(s,u)});return o.finally(function(){return i._unlock()}),o._lib=!0,o});var a=new D(function(o,s){var u=n(o,s,i);u&&u.then&&u.then(o,s)});return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(t){var n=this._root(),r=D.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var a=n._waitingFor;return new D(function(o,s){r.then(function(u){return n._waitingQueue.push(N(o.bind(null,u)))},function(u){return n._waitingQueue.push(N(s.bind(null,u)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new x.Abort))},e.prototype.table=function(t){var n=this._memoizedTables||(this._memoizedTables={});if(G(n,t))return n[t];var r=this.schema[t];if(!r)throw new x.NotFound("Table "+t+" not part of transaction");var i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i},e}();function di(e){return Ze(hi.prototype,function(n,r,i,a,o){var s=this;this.db=e,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=$e(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new D(function(u,c){s._resolve=u,s._reject=c}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(u){var c=s.active;return s.active=!1,s.on.error.fire(u),s.parent?s.parent._reject(u):c&&s.idbtrans&&s.idbtrans.abort(),U(u)})})}function Xt(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+or(t)}}function or(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function sr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Nn(n,function(r){return[r.name,r]})}}function vi(e){return e.length===1?e[0]:e}var ze=function(e){try{return e.only([[]]),ze=function(){return[[]]},[[]]}catch{return ze=function(){return be},be}};function Qt(e){return e==null?function(){}:typeof e=="string"?pi(e):function(t){return ue(t,e)}}function pi(e){var t=e.split(".");return t.length===1?function(n){return n[e]}:function(n){return ue(n,e)}}function Kn(e){return[].slice.call(e)}var yi=0;function Ue(e){return e==null?":id":typeof e=="string"?e:"["+e.join("+")+"]"}function gi(e,t,n){function r(f,v){var b=Kn(f.objectStoreNames);return{schema:{name:f.name,tables:b.map(function(p){return v.objectStore(p)}).map(function(p){var d=p.keyPath,g=p.autoIncrement,w=H(d),E=d==null,m={},_={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:E,compound:w,keyPath:d,autoIncrement:g,unique:!0,extractKey:Qt(d)},indexes:Kn(p.indexNames).map(function(y){return p.index(y)}).map(function(y){var S=y.name,M=y.unique,A=y.multiEntry,R=y.keyPath,K=H(R),I={name:S,compound:K,keyPath:R,unique:M,multiEntry:A,extractKey:Qt(R)};return m[Ue(R)]=I,I}),getIndexByKeyPath:function(y){return m[Ue(y)]}};return m[":id"]=_.primaryKey,d!=null&&(m[Ue(d)]=_.primaryKey),_})},hasGetAll:b.length>0&&"getAll"in v.objectStore(b[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(f){if(f.type===3)return null;if(f.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var v=f.lower,b=f.upper,p=f.lowerOpen,d=f.upperOpen,g=v===void 0?b===void 0?null:t.upperBound(b,!!d):b===void 0?t.lowerBound(v,!!p):t.bound(v,b,!!p,!!d);return g}function a(f){var v=f.name;function b(g){var w=g.trans,E=g.type,m=g.keys,_=g.values,y=g.range;return new Promise(function(S,M){S=N(S);var A=w.objectStore(v),R=A.keyPath==null,K=E==="put"||E==="add";if(!K&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);var I=(m||_||{length:1}).length;if(m&&_&&m.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(I===0)return S({numFailures:0,failures:{},results:[],lastResult:void 0});var O,T=[],V=[],P=0,X=function(ee){++P,We(ee)};if(E==="deleteRange"){if(y.type===4)return S({numFailures:P,failures:V,results:[],lastResult:void 0});y.type===3?T.push(O=A.clear()):T.push(O=A.delete(i(y)))}else{var q=K?R?[_,m]:[_,null]:[m,null],fe=q[0],Z=q[1];if(K)for(var Q=0;Q<I;++Q)T.push(O=Z&&Z[Q]!==void 0?A[E](fe[Q],Z[Q]):A[E](fe[Q])),O.onerror=X;else for(var Q=0;Q<I;++Q)T.push(O=A[E](fe[Q])),O.onerror=X}var he=function(ee){var Oe=ee.target.result;T.forEach(function(J,et){return J.error!=null&&(V[et]=J.error)}),S({numFailures:P,failures:V,results:E==="delete"?m:T.map(function(J){return J.result}),lastResult:Oe})};O.onerror=function(ee){X(ee),he(ee)},O.onsuccess=he})}function p(g){var w=g.trans,E=g.values,m=g.query,_=g.reverse,y=g.unique;return new Promise(function(S,M){S=N(S);var A=m.index,R=m.range,K=w.objectStore(v),I=A.isPrimaryKey?K:K.index(A.name),O=_?y?"prevunique":"prev":y?"nextunique":"next",T=E||!("openKeyCursor"in I)?I.openCursor(i(R),O):I.openKeyCursor(i(R),O);T.onerror=te(M),T.onsuccess=N(function(V){var P=T.result;if(!P){S(null);return}P.___id=++yi,P.done=!1;var X=P.continue.bind(P),q=P.continuePrimaryKey;q&&(q=q.bind(P));var fe=P.advance.bind(P),Z=function(){throw new Error("Cursor not started")},Q=function(){throw new Error("Cursor not stopped")};P.trans=w,P.stop=P.continue=P.continuePrimaryKey=P.advance=Z,P.fail=N(M),P.next=function(){var he=this,ee=1;return this.start(function(){return ee--?he.continue():he.stop()}).then(function(){return he})},P.start=function(he){var ee=new Promise(function(J,et){J=N(J),T.onerror=te(et),P.fail=et,P.stop=function(hr){P.stop=P.continue=P.continuePrimaryKey=P.advance=Q,J(hr)}}),Oe=function(){if(T.result)try{he()}catch(J){P.fail(J)}else P.done=!0,P.start=function(){throw new Error("Cursor behind last entry")},P.stop()};return T.onsuccess=N(function(J){T.onsuccess=Oe,Oe()}),P.continue=X,P.continuePrimaryKey=q,P.advance=fe,Oe(),ee},S(P)},M)})}function d(g){return function(w){return new Promise(function(E,m){E=N(E);var _=w.trans,y=w.values,S=w.limit,M=w.query,A=S===1/0?void 0:S,R=M.index,K=M.range,I=_.objectStore(v),O=R.isPrimaryKey?I:I.index(R.name),T=i(K);if(S===0)return E({result:[]});if(g){var V=y?O.getAll(T,A):O.getAllKeys(T,A);V.onsuccess=function(fe){return E({result:fe.target.result})},V.onerror=te(m)}else{var P=0,X=y||!("openKeyCursor"in O)?O.openCursor(T):O.openKeyCursor(T),q=[];X.onsuccess=function(fe){var Z=X.result;if(!Z)return E({result:q});if(q.push(y?Z.value:Z.primaryKey),++P===S)return E({result:q});Z.continue()},X.onerror=te(m)}})}}return{name:v,schema:f,mutate:b,getMany:function(g){var w=g.trans,E=g.keys;return new Promise(function(m,_){m=N(m);for(var y=w.objectStore(v),S=E.length,M=new Array(S),A=0,R=0,K,I=function(P){var X=P.target;(M[X._pos]=X.result)!=null,++R===A&&m(M)},O=te(_),T=0;T<S;++T){var V=E[T];V!=null&&(K=y.get(E[T]),K._pos=T,K.onsuccess=I,K.onerror=O,++A)}A===0&&m(M)})},get:function(g){var w=g.trans,E=g.key;return new Promise(function(m,_){m=N(m);var y=w.objectStore(v),S=y.get(E);S.onsuccess=function(M){return m(M.target.result)},S.onerror=te(_)})},query:d(u),openCursor:p,count:function(g){var w=g.query,E=g.trans,m=w.index,_=w.range;return new Promise(function(y,S){var M=E.objectStore(v),A=m.isPrimaryKey?M:M.index(m.name),R=i(_),K=R?A.count(R):A.count();K.onsuccess=N(function(I){return y(I.target.result)}),K.onerror=te(S)})}}}var o=r(e,n),s=o.schema,u=o.hasGetAll,c=s.tables.map(function(f){return a(f)}),h={};return c.forEach(function(f){return h[f.name]=f}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(f){var v=h[f];if(!v)throw new Error("Table '"+f+"' not found");return h[f]},MIN_KEY:-1/0,MAX_KEY:ze(t),schema:s}}function mi(e,t){return t.reduce(function(n,r){var i=r.create;return k(k({},n),i(n))},e)}function _i(e,t,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=mi(gi(t,i,r),e.dbcore);return{dbcore:a}}function dn(e,t){var n=e._novip,r=t.db,i=_i(n._middlewares,r,n._deps,t);n.core=i.dbcore,n.tables.forEach(function(a){var o=a.name;n.core.schema.tables.some(function(s){return s.name===o})&&(a.core=n.core.table(o),n[o]instanceof n.Table&&(n[o].core=a.core))})}function _t(e,t,n,r){var i=e._novip;n.forEach(function(a){var o=r[a];t.forEach(function(s){var u=rn(s,a);(!u||"value"in u&&u.value===void 0)&&(s===i.Transaction.prototype||s instanceof i.Transaction?ce(s,a,{get:function(){return this.table(a)},set:function(c){On(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):s[a]=new i.Table(a,o))})})}function qt(e,t){var n=e._novip;t.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function bi(e,t){return e._cfg.version-t._cfg.version}function wi(e,t,n,r){var i=e._dbSchema,a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),s=C.transless||C;ye(function(){C.trans=a,C.transless=s,t===0?(L(i).forEach(function(u){vn(n,u,i[u].primKey,i[u].indexes)}),dn(e,n),D.follow(function(){return e.on.populate.fire(a)}).catch(o)):Ei(e,t,a,n).catch(o)})}function Ei(e,t,n,r){var i=e._novip,a=[],o=i._versions,s=i._dbSchema=pn(i,i.idbdb,r),u=!1,c=o.filter(function(f){return f._cfg.version>=t});c.forEach(function(f){a.push(function(){var v=s,b=f._cfg.dbschema;$t(i,v,r),$t(i,b,r),s=i._dbSchema=b;var p=ur(v,b);p.add.forEach(function(_){vn(r,_[0],_[1].primKey,_[1].indexes)}),p.change.forEach(function(_){if(_.recreate)throw new x.Upgrade("Not yet support for changing primary key");var y=r.objectStore(_.name);_.add.forEach(function(S){return Jt(y,S)}),_.change.forEach(function(S){y.deleteIndex(S.name),Jt(y,S)}),_.del.forEach(function(S){return y.deleteIndex(S)})});var d=f._cfg.contentUpgrade;if(d&&f._cfg.version>t){dn(i,r),n._memoizedTables={},u=!0;var g=Ln(b);p.del.forEach(function(_){g[_]=v[_]}),qt(i,[i.Transaction.prototype]),_t(i,[i.Transaction.prototype],L(g),g),n.schema=g;var w=an(d);w&&Te();var E,m=D.follow(function(){if(E=d(n),E&&w){var _=le.bind(null,null);E.then(_,_)}});return E&&typeof E.then=="function"?D.resolve(E):m.then(function(){return E})}}),a.push(function(v){if(!u||!Jr){var b=f._cfg.dbschema;Ai(b,v)}qt(i,[i.Transaction.prototype]),_t(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function h(){return a.length?D.resolve(a.shift()(n.idbtrans)).then(h):D.resolve()}return h().then(function(){Si(s,r)})}function ur(e,t){var n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],a=t[r];if(!i)n.add.push([r,a]);else{var o={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!At)o.recreate=!0,n.change.push(o);else{var s=i.idxByName,u=a.idxByName,c=void 0;for(c in s)u[c]||o.del.push(c);for(c in u){var h=s[c],f=u[c];h?h.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function vn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Jt(i,a)}),i}function Si(e,t){L(e).forEach(function(n){t.db.objectStoreNames.contains(n)||vn(t,n,e[n].primKey,e[n].indexes)})}function Ai(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function Jt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function pn(e,t,n){var r={},i=Et(t.objectStoreNames,0);return i.forEach(function(a){for(var o=n.objectStore(a),s=o.keyPath,u=Xt(or(s),s||"",!1,!1,!!o.autoIncrement,s&&typeof s!="string",!0),c=[],h=0;h<o.indexNames.length;++h){var f=o.index(o.indexNames[h]);s=f.keyPath;var v=Xt(f.name,s,!!f.unique,!!f.multiEntry,!1,s&&typeof s!="string",!1);c.push(v)}r[a]=sr(a,u,c)}),r}function Di(e,t,n){var r=e._novip;r.verno=t.version/10;var i=r._dbSchema=pn(r,t,n);r._storeNames=Et(t.objectStoreNames,0),_t(r,[r._allTables],L(i),i)}function Ci(e,t){var n=pn(e,e.idbdb,t),r=ur(n,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function $t(e,t,n){for(var r=e._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var o=i[a],s=n.objectStore(o);r._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var c=s.indexNames[u],h=s.index(c).keyPath,f=typeof h=="string"?h:"["+Et(h).join("+")+"]";if(t[o]){var v=t[o].idxByName[f];v&&(v.name=c,delete t[o].idxByName[f],t[o].idxByName[c]=v)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&F.WorkerGlobalScope&&F instanceof F.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Mi(e){return e.split(",").map(function(t,n){t=t.trim();var r=t.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Xt(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),H(i),n===0)})}var Ri=function(){function e(){}return e.prototype._parseStoresSpec=function(t,n){L(t).forEach(function(r){if(t[r]!==null){var i=Mi(t[r]),a=i.shift();if(a.multi)throw new x.Schema("Primary key cannot be multi-valued");i.forEach(function(o){if(o.auto)throw new x.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new x.Schema("Index must have a name and cannot be an empty string")}),n[r]=sr(r,a,i)}})},e.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?Y(this._cfg.storesSource,t):t;var r=n._versions,i={},a={};return r.forEach(function(o){Y(i,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(i,a)}),n._dbSchema=a,qt(n,[n._allTables,n,n.Transaction.prototype]),_t(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],L(a),a),n._storeNames=L(a),this},e.prototype.upgrade=function(t){return this._cfg.contentUpgrade=un(this._cfg.contentUpgrade||B,t),this},e}();function xi(e){return Ze(Ri.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function yn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new bn(Dt,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function gn(e){return e&&typeof e.databases=="function"}function Ki(e){var t=e.indexedDB,n=e.IDBKeyRange;return gn(t)?Promise.resolve(t.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Dt})}):yn(t,n).toCollection().primaryKeys()}function Pi(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!gn(n)&&t!==Dt&&yn(n,r).put({name:t}).catch(B)}function ki(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!gn(n)&&t!==Dt&&yn(n,r).delete(t).catch(B)}function Zt(e){return ye(function(){return C.letThrough=!0,e()})}function Ti(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)})}function Ii(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?U(t.dbOpenError):e});ne&&(t.openCanceller._stackHolder=De()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new x.DatabaseClosed("db.open() was cancelled")}var a=t.dbReadyResolve,o=null,s=!1;return D.race([r,(typeof navigator>"u"?D.resolve():Ti()).then(function(){return new D(function(u,c){if(i(),!n)throw new x.MissingAPI;var h=e.name,f=t.autoSchema?n.open(h):n.open(h,Math.round(e.verno*10));if(!f)throw new x.MissingAPI;f.onerror=te(c),f.onblocked=N(e._fireOnBlocked),f.onupgradeneeded=N(function(v){if(o=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=We,o.abort(),f.result.close();var b=n.deleteDatabase(h);b.onsuccess=b.onerror=N(function(){c(new x.NoSuchDatabase("Database "+h+" doesnt exist"))})}else{o.onerror=te(c);var p=v.oldVersion>Math.pow(2,62)?0:v.oldVersion;s=p<1,e._novip.idbdb=f.result,wi(e,p/10,o,c)}},c),f.onsuccess=N(function(){o=null;var v=e._novip.idbdb=f.result,b=Et(v.objectStoreNames);if(b.length>0)try{var p=v.transaction(vi(b),"readonly");t.autoSchema?Di(e,v,p):($t(e,e._dbSchema,p),Ci(e,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),dn(e,p)}catch{}Le.push(e),v.onversionchange=N(function(d){t.vcFired=!0,e.on("versionchange").fire(d)}),v.onclose=N(function(d){e.on("close").fire(d)}),s&&Pi(e._deps,h),u()},c)})})]).then(function(){return i(),t.onReadyBeingFired=[],D.resolve(Zt(function(){return e.on.ready.fire(e.vip)})).then(function u(){if(t.onReadyBeingFired.length>0){var c=t.onReadyBeingFired.reduce(un,B);return t.onReadyBeingFired=[],D.resolve(Zt(function(){return c(e.vip)})).then(u)}})}).finally(function(){t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(function(){return e}).catch(function(u){t.dbOpenError=u;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),U(u)}).finally(function(){t.openComplete=!0,a()})}function en(e){var t=function(o){return e.next(o)},n=function(o){return e.throw(o)},r=a(t),i=a(n);function a(o){return function(s){var u=o(s),c=u.value;return u.done?c:!c||typeof c.then!="function"?H(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(t)()}function Oi(e,t,n){var r=arguments.length;if(r<2)throw new x.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=Un(i);return[e,a,n]}function cr(e,t,n,r,i){return D.resolve().then(function(){var a=C.transless||C,o=e._createTransaction(t,n,e._dbSchema,r),s={trans:o,transless:a};if(r)o.idbtrans=r.idbtrans;else try{o.create(),e._state.PR1398_maxLoop=3}catch(f){return f.name===sn.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return cr(e,t,n,null,i)})):U(f)}var u=an(i);u&&Te();var c,h=D.follow(function(){if(c=i.call(o,o),c)if(u){var f=le.bind(null,null);c.then(f,f)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=en(c))},s);return(c&&typeof c.then=="function"?D.resolve(c).then(function(f){return o.active?f:U(new x.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):h.then(function(){return c})).then(function(f){return r&&o._resolve(),o._completion.then(function(){return f})}).catch(function(f){return o._reject(f),U(f)})})}function at(e,t,n){for(var r=H(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Bi(e){return k(k({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function o(d,g,w){var E=Ue(d),m=i[E]=i[E]||[],_=d==null?0:typeof d=="string"?1:d.length,y=g>0,S=k(k({},w),{isVirtual:y,keyTail:g,keyLength:_,extractKey:Qt(d),unique:!y&&w.unique});if(m.push(S),S.isPrimaryKey||a.push(S),_>1){var M=_===2?d[0]:d.slice(0,_-1);o(M,g+1,w)}return m.sort(function(A,R){return A.keyTail-R.keyTail}),S}var s=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var u=0,c=r.indexes;u<c.length;u++){var h=c[u];o(h.keyPath,0,h)}function f(d){var g=i[Ue(d)];return g&&g[0]}function v(d,g){return{type:d.type===1?2:d.type,lower:at(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,g),lowerOpen:!0,upper:at(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,g),upperOpen:!0}}function b(d){var g=d.query.index;return g.isVirtual?k(k({},d),{query:{index:g,range:v(d.query.range,g.keyTail)}}):d}var p=k(k({},n),{schema:k(k({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:f}),count:function(d){return n.count(b(d))},query:function(d){return n.query(b(d))},openCursor:function(d){var g=d.query.index,w=g.keyTail,E=g.isVirtual,m=g.keyLength;if(!E)return n.openCursor(d);function _(y){function S(A){A!=null?y.continue(at(A,d.reverse?e.MAX_KEY:e.MIN_KEY,w)):d.unique?y.continue(y.key.slice(0,m).concat(d.reverse?e.MIN_KEY:e.MAX_KEY,w)):y.continue()}var M=Object.create(y,{continue:{value:S},continuePrimaryKey:{value:function(A,R){y.continuePrimaryKey(at(A,e.MAX_KEY,w),R)}},primaryKey:{get:function(){return y.primaryKey}},key:{get:function(){var A=y.key;return m===1?A[0]:A.slice(0,m)}},value:{get:function(){return y.value}}});return M}return n.openCursor(b(d)).then(function(y){return y&&_(y)})}});return p}})}var Fi={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Bi};function mn(e,t,n,r){return n=n||{},r=r||"",L(e).forEach(function(i){if(!G(t,i))n[r+i]=void 0;else{var a=e[i],o=t[i];if(typeof a=="object"&&typeof o=="object"&&a&&o){var s=Ot(a),u=Ot(o);s!==u?n[r+i]=t[i]:s==="Object"?mn(a,o,n,r+i+"."):a!==o&&(n[r+i]=t[i])}else a!==o&&(n[r+i]=t[i])}}),L(t).forEach(function(i){G(e,i)||(n[r+i]=t[i])}),n}function Ni(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Li={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return k(k({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey,i=k(k({},n),{mutate:function(a){var o=C.trans,s=o.table(t).hook,u=s.deleting,c=s.creating,h=s.updating;switch(a.type){case"add":if(c.fire===B)break;return o._promise("readwrite",function(){return f(a)},!0);case"put":if(c.fire===B&&h.fire===B)break;return o._promise("readwrite",function(){return f(a)},!0);case"delete":if(u.fire===B)break;return o._promise("readwrite",function(){return f(a)},!0);case"deleteRange":if(u.fire===B)break;return o._promise("readwrite",function(){return v(a)},!0)}return n.mutate(a);function f(p){var d=C.trans,g=p.keys||Ni(r,p);if(!g)throw new Error("Keys missing");return p=p.type==="add"||p.type==="put"?k(k({},p),{keys:g}):k({},p),p.type!=="delete"&&(p.values=Tt([],p.values,!0)),p.keys&&(p.keys=Tt([],p.keys,!0)),Ui(n,p,g).then(function(w){var E=g.map(function(m,_){var y=w[_],S={onerror:null,onsuccess:null};if(p.type==="delete")u.fire.call(S,m,y,d);else if(p.type==="add"||y===void 0){var M=c.fire.call(S,m,p.values[_],d);m==null&&M!=null&&(m=M,p.keys[_]=m,r.outbound||$(p.values[_],r.keyPath,m))}else{var A=mn(y,p.values[_]),R=h.fire.call(S,A,m,y,d);if(R){var K=p.values[_];Object.keys(R).forEach(function(I){G(K,I)?K[I]=R[I]:$(K,I,R[I])})}}return S});return n.mutate(p).then(function(m){for(var _=m.failures,y=m.results,S=m.numFailures,M=m.lastResult,A=0;A<g.length;++A){var R=y?y[A]:g[A],K=E[A];R==null?K.onerror&&K.onerror(_[A]):K.onsuccess&&K.onsuccess(p.type==="put"&&w[A]?p.values[A]:R)}return{failures:_,results:y,numFailures:S,lastResult:M}}).catch(function(m){return E.forEach(function(_){return _.onerror&&_.onerror(m)}),Promise.reject(m)})})}function v(p){return b(p.trans,p.range,1e4)}function b(p,d,g){return n.query({trans:p,values:!1,query:{index:r,range:d},limit:g}).then(function(w){var E=w.result;return f({type:"delete",keys:E,trans:p}).then(function(m){return m.numFailures>0?Promise.reject(m.failures[0]):E.length<g?{failures:[],numFailures:0,lastResult:void 0}:b(p,k(k({},d),{lower:E[E.length-1],lowerOpen:!0}),g)})})}}});return i}})}};function Ui(e,t,n){return t.type==="add"?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function lr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)W(t.keys[i],e[a])===0&&(r.push(n?Xe(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Vi={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return k(k({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=lr(r.keys,r.trans._cache,r.cache==="clone");return i?D.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Xe(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},kt;function _n(e){return!("from"in e)}var ae=function(e,t){if(this)Y(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new ae;return e&&"d"in e&&Y(n,e),n}};Ke(ae.prototype,(kt={add:function(e){return bt(this,e),this},addKey:function(e){return Ge(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Ge(t,n,n)}),this}},kt[Bt]=function(){return tn(this)},kt));function Ge(e,t,n){var r=W(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(_n(e))return Y(e,{from:t,to:n,d:1});var i=e.l,a=e.r;if(W(n,e.from)<0)return i?Ge(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Pn(e);if(W(t,e.to)>0)return a?Ge(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Pn(e);W(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),W(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var o=!e.r;i&&!e.l&&bt(e,i),a&&o&&bt(e,a)}}function bt(e,t){function n(r,i){var a=i.from,o=i.to,s=i.l,u=i.r;Ge(r,a,o),s&&n(r,s),u&&n(r,u)}_n(t)||n(e,t)}function ji(e,t){var n=tn(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=tn(e),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(W(s.from,i.to)<=0&&W(s.to,i.from)>=0)return!0;W(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function tn(e){var t=_n(e)?null:{s:0,n:e};return{next:function(n){for(var r=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&W(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||W(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Pn(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",o=k({},e),s=e[i];e.from=s.from,e.to=s.to,e[i]=s[i],o[i]=s[a],e[a]=o,o.d=kn(o)}e.d=kn(e)}function kn(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}var Hi={stack:"dbcore",level:0,create:function(e){var t=e.schema.name,n=new ae(e.MIN_KEY,e.MAX_KEY);return k(k({},e),{table:function(r){var i=e.table(r),a=i.schema,o=a.primaryKey,s=o.extractKey,u=o.outbound,c=k(k({},i),{mutate:function(v){var b=v.trans,p=b.mutatedParts||(b.mutatedParts={}),d=function(M){var A="idb://"+t+"/"+r+"/"+M;return p[A]||(p[A]=new ae)},g=d(""),w=d(":dels"),E=v.type,m=v.type==="deleteRange"?[v.range]:v.type==="delete"?[v.keys]:v.values.length<50?[[],v.values]:[],_=m[0],y=m[1],S=v.trans._cache;return i.mutate(v).then(function(M){if(H(_)){E!=="delete"&&(_=M.results),g.addKeys(_);var A=lr(_,S);!A&&E!=="add"&&w.addKeys(_),(A||y)&&Wi(d,a,A,y)}else if(_){var R={from:_.lower,to:_.upper};w.add(R),g.add(R)}else g.add(n),w.add(n),a.indexes.forEach(function(K){return d(K.name).add(n)});return M})}}),h=function(v){var b,p,d=v.query,g=d.index,w=d.range;return[g,new ae((b=w.lower)!==null&&b!==void 0?b:e.MIN_KEY,(p=w.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},f={get:function(v){return[o,new ae(v.key)]},getMany:function(v){return[o,new ae().addKeys(v.keys)]},count:h,query:h,openCursor:h};return L(f).forEach(function(v){c[v]=function(b){var p=C.subscr;if(p){var d=function(S){var M="idb://"+t+"/"+r+"/"+S;return p[M]||(p[M]=new ae)},g=d(""),w=d(":dels"),E=f[v](b),m=E[0],_=E[1];if(d(m.name||"").add(_),!m.isPrimaryKey)if(v==="count")w.add(n);else{var y=v==="query"&&u&&b.values&&i.query(k(k({},b),{values:!1}));return i[v].apply(this,arguments).then(function(S){if(v==="query"){if(u&&b.values)return y.then(function(K){var I=K.result;return g.addKeys(I),S});var M=b.values?S.result.map(s):S.result;b.values?g.addKeys(M):w.addKeys(M)}else if(v==="openCursor"){var A=S,R=b.values;return A&&Object.create(A,{key:{get:function(){return w.addKey(A.primaryKey),A.key}},primaryKey:{get:function(){var K=A.primaryKey;return w.addKey(K),K}},value:{get:function(){return R&&g.addKey(A.primaryKey),A.value}}})}return S})}}return i[v].apply(this,arguments)}}),c}})}};function Wi(e,t,n,r){function i(a){var o=e(a.name||"");function s(c){return c!=null?a.extractKey(c):null}var u=function(c){return a.multiEntry&&H(c)?c.forEach(function(h){return o.addKey(h)}):o.addKey(c)};(n||r).forEach(function(c,h){var f=n&&s(n[h]),v=r&&s(r[h]);W(f,v)!==0&&(f!=null&&u(f),v!=null&&u(v))})}t.indexes.forEach(i)}var bn=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=k({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:B,dbReadyPromise:null,cancelOpen:B,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};o.dbReadyPromise=new D(function(s){o.dbReadyResolve=s}),o.openCanceller=new D(function(s,u){o.cancelOpen=u}),this._state=o,this.name=t,this.on=$e(this,"populate","blocked","versionchange","close",{ready:[un,B]}),this.on.ready.subscribe=Bn(this.on.ready.subscribe,function(s){return function(u,c){e.vip(function(){var h=r._state;if(h.openComplete)h.dbOpenError||D.resolve().then(u),c&&s(u);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(u),c&&s(u);else{s(u);var f=r;c||s(function v(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(v)})}})}}),this.Collection=ai(this),this.Table=ei(this),this.Transaction=di(this),this.Version=xi(this),this.WhereClause=fi(this),this.on("versionchange",function(s){s.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+s.oldVersion/10)}),this._maxKey=ze(n.IDBKeyRange),this._createTransaction=function(s,u,c,h){return new r.Transaction(s,u,c,r._options.chromeTransactionDurability,h)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),Le.filter(function(u){return u.name===r.name&&u!==r&&!u._state.vcFired}).map(function(u){return u.on("versionchange").fire(s)})},this.use(Fi),this.use(Li),this.use(Hi),this.use(Vi),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(s){return s(r)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new x.Type("Given version is not a positive number");if(t=Math.round(t*10)/10,this.idbdb||this._state.isBeingOpened)throw new x.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=this._versions,r=n.filter(function(i){return i._cfg.version===t})[0];return r||(r=new this.Version(t),n.push(r),n.sort(bi),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(t){var n=this;return this.idbdb&&(this._state.openComplete||C.letThrough||this._vip)?t():new D(function(r,i){if(n._state.openComplete)return i(new x.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new x.DatabaseClosed);return}n.open().catch(B)}n._state.dbReadyPromise.then(r,i)}).then(t)},e.prototype.use=function(t){var n=t.stack,r=t.create,i=t.level,a=t.name;a&&this.unuse({stack:n,name:a});var o=this._middlewares[n]||(this._middlewares[n]=[]);return o.push({stack:n,create:r,level:i??10,name:a}),o.sort(function(s,u){return s.level-u.level}),this},e.prototype.unuse=function(t){var n=t.stack,r=t.name,i=t.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},e.prototype.open=function(){return Ii(this)},e.prototype._close=function(){var t=this._state,n=Le.indexOf(this);if(n>=0&&Le.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new D(function(r){t.dbReadyResolve=r}),t.openCanceller=new D(function(r,i){t.cancelOpen=i})},e.prototype.close=function(){this._close();var t=this._state;this._options.autoOpen=!1,t.dbOpenError=new x.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)},e.prototype.delete=function(){var t=this,n=arguments.length>0,r=this._state;return new D(function(i,a){var o=function(){t.close();var s=t._deps.indexedDB.deleteDatabase(t.name);s.onsuccess=N(function(){ki(t._deps,t.name),i()}),s.onerror=te(a),s.onblocked=t._fireOnBlocked};if(n)throw new x.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return L(this._allTables).map(function(n){return t._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var t=Oi.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,n,r){var i=this,a=C.trans;(!a||a.db!==this||t.indexOf("!")!==-1)&&(a=null);var o=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");var s,u;try{if(u=n.map(function(h){var f=h instanceof i.Table?h.name:h;if(typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),t=="r"||t===Mt)s=Mt;else if(t=="rw"||t==Rt)s=Rt;else throw new x.InvalidArgument("Invalid transaction mode: "+t);if(a){if(a.mode===Mt&&s===Rt)if(o)a=null;else throw new x.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&u.forEach(function(h){if(a&&a.storeNames.indexOf(h)===-1)if(o)a=null;else throw new x.SubTransaction("Table "+h+" not included in parent transaction.")}),o&&a&&!a.active&&(a=null)}}catch(h){return a?a._promise(null,function(f,v){v(h)}):U(h)}var c=cr.bind(null,this,s,u,a,r);return a?a._promise(s,c,"lock"):C.trans?Ie(C.transless,function(){return i._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(t){if(!G(this._allTables,t))throw new x.InvalidTable("Table "+t+" does not exist");return this._allTables[t]},e}(),Yi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",zi=function(){function e(t){this._subscribe=t}return e.prototype.subscribe=function(t,n,r){return this._subscribe(!t||typeof t=="function"?{next:t,error:n,complete:r}:t)},e.prototype[Yi]=function(){return this},e}();function fr(e,t){return L(t).forEach(function(n){var r=e[n]||(e[n]=new ae);bt(r,t[n])}),e}function Gi(e){return new zi(function(t){var n=an(e);function r(b){n&&Te();var p=function(){return ye(e,{subscr:b,trans:null})},d=C.trans?Ie(C.transless,p):p();return n&&d.then(le,le),d}var i=!1,a={},o={},s={get closed(){return i},unsubscribe:function(){i=!0,me.storagemutated.unsubscribe(f)}};t.start&&t.start(s);var u=!1,c=!1;function h(){return L(o).some(function(b){return a[b]&&ji(a[b],o[b])})}var f=function(b){fr(a,b),h()&&v()},v=function(){if(!(u||i)){a={};var b={},p=r(b);c||(me(Ye,f),c=!0),u=!0,Promise.resolve(p).then(function(d){u=!1,!i&&(h()?v():(a={},o=b,t.next&&t.next(d)))},function(d){u=!1,t.error&&t.error(d),s.unsubscribe()})}};return v(),s})}var nn;try{nn={indexedDB:F.indexedDB||F.mozIndexedDB||F.webkitIndexedDB||F.msIndexedDB,IDBKeyRange:F.IDBKeyRange||F.webkitIDBKeyRange}}catch{nn={indexedDB:null,IDBKeyRange:null}}var _e=bn;Ke(_e,k(k({},St),{delete:function(e){var t=new _e(e,{addons:[]});return t.delete()},exists:function(e){return new _e(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return Ki(_e.dependencies).then(e)}catch{return U(new x.MissingAPI)}},defineClass:function(){function e(t){Y(this,t)}return e},ignoreTransaction:function(e){return C.trans?Ie(C.transless,e):e()},vip:Zt,async:function(e){return function(){try{var t=en(e.apply(this,arguments));return!t||typeof t.then!="function"?D.resolve(t):t}catch(n){return U(n)}}},spawn:function(e,t,n){try{var r=en(e.apply(n,t||[]));return!r||typeof r.then!="function"?D.resolve(r):r}catch(i){return U(i)}},currentTransaction:{get:function(){return C.trans||null}},waitFor:function(e,t){var n=D.resolve(typeof e=="function"?_e.ignoreTransaction(e):e).timeout(t||6e4);return C.trans?C.trans.waitFor(n):n},Promise:D,debug:{get:function(){return ne},set:function(e){jn(e,e==="dexie"?function(){return!0}:nr)}},derive:Pe,extend:Y,props:Ke,override:Bn,Events:$e,on:me,liveQuery:Gi,extendObservabilitySet:fr,getByKeyPath:ue,setByKeyPath:$,delByKeyPath:Dr,shallowClone:Ln,deepClone:Xe,getObjectDiff:mn,cmp:W,asap:Fn,minKey:Gt,addons:[],connections:Le,errnames:sn,dependencies:nn,semVer:Dn,version:Dn.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,n*2)})}));_e.maxKey=ze(_e.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(me(Ye,function(e){if(!se){var t;At?(t=document.createEvent("CustomEvent"),t.initCustomEvent(pe,!0,!0,e)):t=new CustomEvent(pe,{detail:e}),se=!0,dispatchEvent(t),se=!1}}),addEventListener(pe,function(e){var t=e.detail;se||wt(t)}));function wt(e){var t=se;try{se=!0,me.storagemutated.fire(e)}finally{se=t}}var se=!1;if(typeof BroadcastChannel<"u"){var ot=new BroadcastChannel(pe);typeof ot.unref=="function"&&ot.unref(),me(Ye,function(e){se||ot.postMessage(e)}),ot.onmessage=function(e){e.data&&wt(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){me(Ye,function(e){try{se||(typeof localStorage<"u"&&localStorage.setItem(pe,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&Tt([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(t){return t.postMessage({type:pe,changedParts:e})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(e){if(e.key===pe){var t=JSON.parse(e.newValue);t&&wt(t.changedParts)}});var Tn=self.document&&navigator.serviceWorker;Tn&&Tn.addEventListener("message",Xi)}function Xi(e){var t=e.data;t&&t.type===pe&&wt(t.changedParts)}D.rejectionMapper=Ir;jn(ne,nr);class Qi extends bn{constructor(){super("myDatabase");re(this,"roms");re(this,"opts");this.version(3).stores({roms:"crc32, title",opts:"key"})}}const Rs=new Qi,xs=1,qi=313,Ks=qi,Ps=227,ks=313,Ts=912,Is=18,Os=26,Bs={Escape:69,F1:80,F2:81,F3:82,F4:83,F5:84,F6:85,F7:86,F8:87,F9:88,F10:89,F11:102,F12:103,Backquote:0,Digit1:1,Digit2:2,Digit3:3,Digit4:4,Digit5:5,Digit6:6,Digit7:7,Digit8:8,Digit9:9,Digit0:10,Minus:11,Equal:12,Backspace:65,Tab:66,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Backslash:13,CapsLock:98,KeyA:32,KeyS:33,KeyD:34,KeyF:35,KeyG:36,KeyH:37,KeyJ:38,KeyK:39,KeyL:40,Semicolon:41,Quote:42,Enter:68,ShiftLeft:96,KeyZ:49,KeyX:50,KeyC:51,KeyV:52,KeyB:53,KeyN:54,KeyM:55,Comma:56,Period:57,Slash:58,ShiftRight:97,ControlLeft:99,AltLeft:100,MetaLeft:102,Space:64,AltRight:101,MetaRight:103,ControlRight:99,Delete:70,End:95,PageDown:69,ArrowUp:76,ArrowDown:77,ArrowRight:78,ArrowLeft:79,NumpadDivide:92,NumpadMultiply:93,NumpadSubtract:74,Numpad7:61,Numpad8:62,Numpad9:63,NumpadAdd:94,Numpad4:45,Numpad5:46,Numpad6:47,Numpad1:29,Numpad2:30,Numpad3:31,NumpadEnter:67,Numpad0:15,NumpadDecimal:60},Fs={Aros:1062194186,Kick12:2798523958,Kick13:3304125791,DiagROM:2231503309};export{zo as $,ds as A,hs as B,fs as C,ls as D,cs as E,us as F,ss as G,os as H,as as I,is as J,rs as K,ns as L,Ms as M,ba as N,pr as O,ts as P,es as Q,gr as R,Zo as S,mr as T,$o as U,Jo as V,_r as W,qo as X,Qo as Y,Xo as Z,Go as _,ra as a,Ma as a$,Yo as a0,Wo as a1,Ho as a2,jo as a3,Vo as a4,Uo as a5,Lo as a6,No as a7,Fo as a8,Bo as a9,uo as aA,so as aB,oo as aC,ao as aD,io as aE,ro as aF,no as aG,to as aH,eo as aI,ca as aJ,ua as aK,sa as aL,oa as aM,Qa as aN,Xa as aO,Ga as aP,za as aQ,Ya as aR,Wa as aS,Ha as aT,Va as aU,Ua as aV,Na as aW,ma as aX,La as aY,Fa as aZ,Ba as a_,Oo as aa,Io as ab,To as ac,ko as ad,Po as ae,Ko as af,xo as ag,Ro as ah,Mo as ai,Co as aj,Do as ak,Ao as al,So as am,Eo as an,wo as ao,bo as ap,_o as aq,mo as ar,go as as,yo as at,po as au,vo as av,ho as aw,fo as ax,lo as ay,co as az,la as b,Ca as b0,_a as b1,ga as b2,ya as b3,pa as b4,va as b5,da as b6,ha as b7,aa as b8,ia as b9,na as ba,Ja as bb,Fs as bc,ka as bd,Da as be,Aa as bf,Ta as bg,Ia as bh,In as bi,qa as bj,yr as bk,Ts as bl,ks as bm,Bs as bn,xs as bo,Is as bp,Ps as bq,Os as br,Ks as bs,Pa as bt,Ka as bu,xa as bv,Ra as bw,Zi as bx,br as by,Oa as bz,wa as c,Ea as d,ta as e,Rs as f,$a as g,fa as h,Sa as i,Cs as j,Ds as k,Gi as l,ja as m,As as n,Ss as o,ea as p,Es as q,ws as r,bs as s,_s as t,ms as u,gs as v,Za as w,ys as x,ps as y,vs as z};
