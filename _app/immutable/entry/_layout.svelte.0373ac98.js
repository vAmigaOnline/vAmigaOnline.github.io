import{S as He,i as Fe,s as Be,D as a,E as s,e as Xe,b as Q,n as pr,h as m,k as ce,r as se,a as Ze,l as ue,m as ge,u as ae,c as ve,p as ne,F as I,v as Xt,o as us,G as fs,z as ze,H as ps,A as Je,B as Ye,I as Os,J as Es,K as Ds,g as Ve,d as we,C as qe,L as ds,x as Zt}from"../chunks/index.0047a4e5.js";import{a as $e,p as ie,i as y,d as G,b as _r,c as xe,e as lr,O as n,W as We,T as L,R as Or,l as Rs,f as Ae,g as Ts,h as Sr,w as As,M as Er,j as Dr,k as dr,m as vt,n as Rr,o as Tr,q as Ar,r as br,s as Pr,t as Cr,u as kr,v as mr,x as Nr,y as Ir,z as hr,A as Lr,B as yr,C as Gr,D as Ur,E as Vr,F as wr,G as Wr,H as xr,I as $t,J as Hr,K as Fr,L as er,N as Br,P as Kr,Q as Mr,S as tr,U as jr,V as zr,X as rr,Y as Jr,Z as Yr,_ as or,$ as qr,a0 as Qr,a1 as Xr,a2 as Zr,a3 as vr,a4 as $r,a5 as eo,a6 as to,a7 as sr,a8 as ro,a9 as oo,aa as so,ab as ao,ac as no,ad as co,ae as uo,af as go,ag as ar,ah as io,ai as _o,aj as lo,ak as So,al as Mo,am as fo,an as po,ao as Oo,ap as Eo,aq as Do,ar as Ro,as as To,at as Ao,au as bo,av as Po,aw as Co,ax as ko,ay as mo,az as No,aA as nr,aB as Io,aC as ho,aD as cr,aE as Lo,aF as yo,aG as ur,aH as Go,aI as Uo,aJ as Vo,aK as wo,aL as Wo,aM as xo,aN as Qe,aO as Ho,aP as Fo,aQ as gr,aR as Bo,aS as Ko,aT as jo,aU as zo,aV as Jo,aW as Yo,aX as qo,aY as Qo,aZ as Xo,a_ as Zo,a$ as vo,b0 as $o,b1 as es,b2 as ts,b3 as rs,b4 as os,b5 as ss,b6 as ir,b7 as as}from"../chunks/constants.79d3c750.js";function bs(o,l,r){let t,c;a(o,$e,R=>r(11,t=R)),a(o,ie,R=>r(12,c=R));let i,_,f,d,A,P=0;async function T(){if(i){console.log("Audio context already initialized: ",i.state);return}i=new AudioContext,i.onstatechange=()=>console.log("Audio Context: state = "+i.state);let R=i.createGain();R.gain.value=.15,R.connect(i.destination),t.setSampleRate(i.sampleRate),await i.audioWorklet.addModule("js/audio-processor.js");const k=new AudioWorkletNode(i,"audio-processor",{outputChannelCount:[2],processorOptions:{pointers:[t.leftChannelBuffer(),t.rightChannelBuffer()],buffer:c.HEAPF32.buffer,length:2048}});k.port.onmessage=U=>{t.updateAudio(U.data)},k.connect(i.destination),i.state==="suspended"&&await i.resume(),await p()}async function p(){_||(_=await C("sounds/insert.mp3")),f||(f=await C("sounds/eject.mp3")),d||(d=await C("sounds/step.mp3")),A||(A=await C("sounds/stephd.mp3"))}function O(R,k){D(_,R)}function b(R,k){D(f,R)}function E(R,k){D(d,R)}function S(R,k){D(A,R)}async function D(R,k,U){if(R==null||P>=3)return;const V=i.createGain();V.gain.value=.004*k,V.connect(i.destination);const h=i.createBufferSource();h.buffer=R,h.addEventListener("ended",()=>{P--}),h.connect(V),h.start(),P++}async function C(R){console.log("load_sound: url = "+R);let U=await(await fetch(R)).arrayBuffer();return await i.decodeAudioData(U)}return[T,O,b,E,S]}class Ps extends He{constructor(l){super(),Fe(this,l,bs,null,Be,{setup:0,playInsertSound:1,playEjectSound:2,playStepSound:3,playClickSound:4})}get setup(){return this.$$.ctx[0]}get playInsertSound(){return this.$$.ctx[1]}get playEjectSound(){return this.$$.ctx[2]}get playStepSound(){return this.$$.ctx[3]}get playClickSound(){return this.$$.ctx[4]}}function Cs(o,l,r){let t,c,i,_,f,d,A;a(o,ie,u=>r(30,t=u)),a(o,$e,u=>r(31,c=u)),a(o,y,u=>r(32,i=u)),a(o,G,u=>r(33,_=u)),a(o,_r,u=>r(34,f=u)),a(o,xe,u=>r(35,d=u)),a(o,lr,u=>r(23,A=u));let P=[{opt:n.WARP_MODE,default:[We.auto].toString()},{opt:n.THEME,default:L.default.toString()},{opt:n.CANVAS_BORDER,default:"0"},{opt:n.SHAKING,default:"1"}],T=[{opt:n.CPU_REVISION,default:"0"},{opt:n.AGNUS_REVISION,default:"0"},{opt:n.DENISE_REVISION,default:"0"},{opt:n.RTC_MODEL,default:"0"},{opt:n.CHIP_RAM,default:"512"},{opt:n.SLOW_RAM,default:"512"},{opt:n.FAST_RAM,default:"0"},{opt:n.BANK_MAP,default:"0"},{opt:n.INIT_PATTERN,default:"0"},{opt:n.UNMAPPED,default:"0"},{opt:n.SLOW_RAM_MIRROR,default:"1"},{opt:n.SLOW_RAM_DELAY,default:"1"},{opt:n.DF0,default:"1"},{opt:n.DF1,default:"1"},{opt:n.DF2,default:"0"},{opt:n.DF3,default:"0"}],p=[{opt:n.AUDVOL0,default:"100"},{opt:n.AUDVOL1,default:"100"},{opt:n.AUDVOL2,default:"100"},{opt:n.AUDVOL3,default:"100"},{opt:n.AUDVOLL,default:"50"},{opt:n.AUDVOLR,default:"50"},{opt:n.STEP_VOLUME,default:"50"},{opt:n.POLL_VOLUME,default:"50"},{opt:n.INSERT_VOLUME,default:"50"},{opt:n.EJECT_VOLUME,default:"50"}],O=[{opt:n.RENDER_MODE,default:Or.smooth.toString()},{opt:n.FLICKER_WEIGHT,default:"0"},{opt:n.PALETTE,default:"0"},{opt:n.BRIGHTNESS,default:"50"},{opt:n.CONTRAST,default:"100"},{opt:n.SATURATION,default:"50"}],b=We.auto,E=L.default,S=0,D=1,C=Or.smooth,R=50,k;Rs(()=>Ae.opts.toArray()).subscribe(u=>{r(22,k=u)});async function V(){console.log("registerDefaults"),await h(),await _e(),await le(),await Se()}async function h(){console.log("registerGeneralDefaults");for(const u of P)await B(u.opt,u.default)}async function _e(){console.log("registerMachineDefaults");for(const u of T)await B(u.opt,u.default)}async function le(){console.log("registerAudioDefaults");for(const u of p)await B(u.opt,u.default)}async function Se(){console.log("registerVideoDefaults");for(const u of O)await B(u.opt,u.default)}async function B(u,g){try{await Ae.opts.add({key:u,value:g})}catch{}}async function X(){console.log("restoreDefaults"),Me(),fe(),K(),pe()}async function Me(){console.log("restoreGeneralDefaults");for(const u of P)await j(u.opt);await h(),await W()}async function fe(){console.log("restoreMachineDefaults");for(const u of T)await j(u.opt);await _e(),await Z()}async function K(){console.log("restoreAudioDefaults");for(const u of p)await j(u.opt);await le(),await v()}async function pe(){console.log("restoreVideoDefaults");for(const u of O)await j(u.opt);await Se(),await x()}async function j(u){try{const g=await Ae.opts.delete(u);console.log("Removed entry ",u)}catch{console.log("FAILED TO REMOVE entry ",u)}}async function w(){console.log("loadSettings"),W(),Z(),v(),x()}async function W(){console.log("loadGeneralSettings");for(const u of P)await z(u.opt)}async function Z(){console.log("loadMachineSettings");for(const u of T)await z(u.opt)}async function v(){console.log("loadAudioSettings");for(const u of p)await z(u.opt)}async function x(){console.log("loadVideoSettings");for(const u of O)await z(u.opt)}async function z(u){console.log("loadSetting ",u);try{const g=await Ae.opts.get(u);console.log("Got key / value pair ",g.key,g.value),q(u,g.value)}catch{console.log("FAILED TO GET entry ",u)}}async function be(){console.log("saveSettings"),J(),Oe(),Ee(),De()}async function J(){console.log("saveGeneralSettings");for(const u of P)await Y(u.opt)}async function Oe(){console.log("saveMachineSettings");for(const u of T)await Y(u.opt)}async function Ee(){console.log("saveAudioSettings");for(const u of p)await Y(u.opt)}async function De(){console.log("saveVideoSettings");for(const u of O)await Y(u.opt)}async function Y(u){const g=$(u);console.log("saveSetting ",u,g);try{const Te=await Ae.opts.put({key:u,value:g});console.log("Saved key / value pair ",u,g)}catch{console.log("FAILED TO SAVE entry ",u)}}function $(u){switch(u){case n.WARP_MODE:return[b].toString();case n.THEME:return[E].toString();case n.CANVAS_BORDER:return S.toString();case n.SHAKING:return D.toString();case n.CPU_REVISION:return c.getConfig(t.OPT_CPU_REVISION).toString();case n.CPU_SPEED:return c.getConfig(t.OPT_CPU_OVERCLOCKING).toString();case n.AGNUS_REVISION:return c.getConfig(t.OPT_AGNUS_REVISION).toString();case n.DENISE_REVISION:return c.getConfig(t.OPT_DENISE_REVISION).toString();case n.RTC_MODEL:return c.getConfig(t.OPT_RTC_MODEL).toString();case n.CHIP_RAM:return c.getConfig(t.OPT_CHIP_RAM).toString();case n.SLOW_RAM:return c.getConfig(t.OPT_SLOW_RAM).toString();case n.FAST_RAM:return c.getConfig(t.OPT_FAST_RAM).toString();case n.BANK_MAP:return c.getConfig(t.OPT_BANKMAP).toString();case n.INIT_PATTERN:return c.getConfig(t.OPT_RAM_INIT_PATTERN).toString();case n.UNMAPPED:return c.getConfig(t.OPT_UNMAPPING_TYPE).toString();case n.SLOW_RAM_MIRROR:return c.getConfig(t.OPT_SLOW_RAM_MIRROR).toString();case n.SLOW_RAM_DELAY:return c.getConfig(t.OPT_SLOW_RAM_DELAY).toString();case n.DF0:return c.getDriveConfig(t.OPT_DRIVE_CONNECT,0).toString();case n.DF1:return c.getDriveConfig(t.OPT_DRIVE_CONNECT,1).toString();case n.DF2:return c.getDriveConfig(t.OPT_DRIVE_CONNECT,2).toString();case n.DF3:return c.getDriveConfig(t.OPT_DRIVE_CONNECT,3).toString();case n.AUDVOL0:return c.getDriveConfig(t.OPT_AUDVOL,0).toString();case n.AUDVOL1:return c.getDriveConfig(t.OPT_AUDVOL,1).toString();case n.AUDVOL2:return c.getDriveConfig(t.OPT_AUDVOL,2).toString();case n.AUDVOL3:return c.getDriveConfig(t.OPT_AUDVOL,3).toString();case n.AUDVOLL:return c.getConfig(t.OPT_AUDVOLL).toString();case n.AUDVOLR:return c.getConfig(t.OPT_AUDVOLR).toString();case n.STEP_VOLUME:return c.getDriveConfig(t.OPT_STEP_VOLUME,0).toString();case n.POLL_VOLUME:return c.getDriveConfig(t.OPT_POLL_VOLUME,0).toString();case n.INSERT_VOLUME:return c.getDriveConfig(t.OPT_INSERT_VOLUME,0).toString();case n.EJECT_VOLUME:return c.getDriveConfig(t.OPT_EJECT_VOLUME,0).toString();case n.RENDER_MODE:return C.toString();case n.PALETTE:return c.getConfig(t.OPT_PALETTE).toString();case n.BRIGHTNESS:return c.getConfig(t.OPT_BRIGHTNESS).toString();case n.CONTRAST:return c.getConfig(t.OPT_CONTRAST).toString();case n.SATURATION:return c.getConfig(t.OPT_SATURATION).toString();case n.FLICKER_WEIGHT:return R.toString();default:return console.warn("get: Invalid option: ",u),"???"}}function de(u){return Number($(u))}function Pe(u){return de(u)!=0}function q(u,g){switch(console.log("In set",u,g),u){case n.WARP_MODE:ke(g);break;case n.THEME:me(Number(g));break;case n.CANVAS_BORDER:S=g;break;case n.SHAKING:D=g;break;case n.CPU_REVISION:c.configure(t.OPT_CPU_REVISION,Number(g));break;case n.CPU_SPEED:c.configure(t.OPT_CPU_OVERCLOCKING,Number(g));break;case n.AGNUS_REVISION:c.configure(t.OPT_AGNUS_REVISION,Number(g));break;case n.DENISE_REVISION:c.configure(t.OPT_DENISE_REVISION,Number(g));break;case n.RTC_MODEL:c.configure(t.OPT_RTC_MODEL,Number(g));break;case n.CHIP_RAM:c.configure(t.OPT_CHIP_RAM,Number(g));break;case n.SLOW_RAM:c.configure(t.OPT_SLOW_RAM,Number(g));break;case n.FAST_RAM:c.configure(t.OPT_FAST_RAM,Number(g));break;case n.BANK_MAP:c.configure(t.OPT_BANKMAP,Number(g));break;case n.INIT_PATTERN:c.configure(t.OPT_RAM_INIT_PATTERN,Number(g));break;case n.UNMAPPED:c.configure(t.OPT_UNMAPPING_TYPE,Number(g));break;case n.SLOW_RAM_MIRROR:c.configure(t.OPT_SLOW_RAM_MIRROR,Number(g));break;case n.SLOW_RAM_DELAY:c.configure(t.OPT_SLOW_RAM_DELAY,Number(g));break;case n.DF0:break;case n.DF1:c.configureDrive(t.OPT_DRIVE_CONNECT,1,g),g==0&&c.configureDrive(t.OPT_DRIVE_CONNECT,2,0),g==0&&c.configureDrive(t.OPT_DRIVE_CONNECT,3,0);break;case n.DF2:g==1&&c.configureDrive(t.OPT_DRIVE_CONNECT,1,1),c.configureDrive(t.OPT_DRIVE_CONNECT,2,g),g==0&&c.configureDrive(t.OPT_DRIVE_CONNECT,3,0);break;case n.DF3:g==0&&c.configureDrive(t.OPT_DRIVE_CONNECT,1,0),g==0&&c.configureDrive(t.OPT_DRIVE_CONNECT,2,0),c.configureDrive(t.OPT_DRIVE_CONNECT,3,g);break;case n.HD0:return"TODO";case n.AUDVOL0:c.configureDrive(t.OPT_AUDVOL,0,Number(g));break;case n.AUDVOL1:c.configureDrive(t.OPT_AUDVOL,1,Number(g));break;case n.AUDVOL2:c.configureDrive(t.OPT_AUDVOL,2,Number(g));break;case n.AUDVOL3:c.configureDrive(t.OPT_AUDVOL,3,Number(g));break;case n.AUDVOLL:c.configure(t.OPT_AUDVOLL,Number(g));break;case n.AUDVOLR:c.configure(t.OPT_AUDVOLR,Number(g));break;case n.STEP_VOLUME:c.configure(t.OPT_STEP_VOLUME,Number(g));break;case n.POLL_VOLUME:c.configure(t.OPT_POLL_VOLUME,Number(g));break;case n.INSERT_VOLUME:c.configure(t.OPT_INSERT_VOLUME,Number(g));break;case n.EJECT_VOLUME:c.configure(t.OPT_EJECT_VOLUME,Number(g));break;case n.RENDER_MODE:C=Number(g);break;case n.PALETTE:c.configure(t.OPT_PALETTE,Number(g));break;case n.BRIGHTNESS:c.configure(t.OPT_BRIGHTNESS,Number(g));break;case n.CONTRAST:c.configure(t.OPT_CONTRAST,Number(g));break;case n.SATURATION:c.configure(t.OPT_SATURATION,Number(g));break;case n.FLICKER_WEIGHT:R=Number(R);break;default:console.warn("set: Invalid option: ",u)}xe.set(d)}function ee(u,g){console.log("setNum: ",g,g.toString()),q(u,g.toString())}function Ce(u,g){q(u,g?"true":"false")}function ke(u){console.log("setWarp",u),b=Number(u),Re()}function Re(){if(console.log("(updateWarpState",b),!c)return;let u=!1;switch(b){case We.auto:u=f.isSpinning();break;case We.never:u=!1;break;case We.always:u=!0;break}u?c.warpOn():c.warpOff()}function me(u){console.log("setTheme",u),E=u;let g="";switch(E){case L.default:g="mytheme",s(G,_=!0,_),s(y,i="invert",i);break;case L.light:g="light",s(G,_=!0,_),s(y,i="invert",i);break;case L.dark:g="dark",s(G,_=!0,_),s(y,i="invert",i);break;case L.coffee:g="coffee",s(G,_=!1,_),s(y,i="",i);break;case L.cupcake:g="cupcake",s(G,_=!1,_),s(y,i="",i);break;case L.forest:g="forest",s(G,_=!0,_),s(y,i="invert",i);break;case L.aqua:g="aqua",s(G,_=!1,_),s(y,i="",i);break;case L.garden:g="garden",s(G,_=!0,_),s(y,i="invert",i);break;case L.pastel:g="pastel",s(G,_=!1,_),s(y,i="",i);break;default:console.log("Invalid theme")}document.querySelector("html").setAttribute("data-theme",g)}return o.$$.update=()=>{o.$$.dirty[0]&4194304&&console.log("CONFIG DB: ",k),o.$$.dirty[0]&8388608&&A&&(V(),w())},[X,Me,fe,K,pe,w,W,Z,v,x,be,J,Oe,Ee,De,$,de,Pe,q,ee,Ce,Re,k,A]}class ks extends He{constructor(l){super(),Fe(this,l,Cs,null,Be,{restoreDefaults:0,restoreGeneralDefaults:1,restoreMachineDefaults:2,restoreAudioDefaults:3,restoreVideoDefaults:4,loadSettings:5,loadGeneralSettings:6,loadMachineSettings:7,loadAudioSettings:8,loadVideoSettings:9,saveSettings:10,saveGeneralSettings:11,saveMachineSettings:12,saveAudioSettings:13,saveVideoSettings:14,get:15,getNum:16,getBool:17,set:18,setNum:19,setBool:20,updateWarpState:21},null,[-1,-1])}get restoreDefaults(){return this.$$.ctx[0]}get restoreGeneralDefaults(){return this.$$.ctx[1]}get restoreMachineDefaults(){return this.$$.ctx[2]}get restoreAudioDefaults(){return this.$$.ctx[3]}get restoreVideoDefaults(){return this.$$.ctx[4]}get loadSettings(){return this.$$.ctx[5]}get loadGeneralSettings(){return this.$$.ctx[6]}get loadMachineSettings(){return this.$$.ctx[7]}get loadAudioSettings(){return this.$$.ctx[8]}get loadVideoSettings(){return this.$$.ctx[9]}get saveSettings(){return this.$$.ctx[10]}get saveGeneralSettings(){return this.$$.ctx[11]}get saveMachineSettings(){return this.$$.ctx[12]}get saveAudioSettings(){return this.$$.ctx[13]}get saveVideoSettings(){return this.$$.ctx[14]}get get(){return this.$$.ctx[15]}get getNum(){return this.$$.ctx[16]}get getBool(){return this.$$.ctx[17]}get set(){return this.$$.ctx[18]}get setNum(){return this.$$.ctx[19]}get setBool(){return this.$$.ctx[20]}get updateWarpState(){return this.$$.ctx[21]}}function ns(o){let l,r,t,c,i,_,f=o[3].ErrorCodeKey(o[1])+"",d,A,P,T,p,O;return{c(){l=ce("div"),r=ce("div"),t=ce("p"),c=se("Software failure. Uncaught exception "),i=se(o[1]),_=se(" ("),d=se(f),A=se(")"),P=Ze(),T=ce("p"),p=se(o[4]),this.h()},l(b){l=ue(b,"DIV",{class:!0});var E=ge(l);r=ue(E,"DIV",{class:!0});var S=ge(r);t=ue(S,"P",{class:!0});var D=ge(t);c=ae(D,"Software failure. Uncaught exception "),i=ae(D,o[1]),_=ae(D," ("),d=ae(D,f),A=ae(D,")"),D.forEach(m),P=ve(S),T=ue(S,"P",{class:!0});var C=ge(T);p=ae(C,o[4]),C.forEach(m),S.forEach(m),E.forEach(m),this.h()},h(){ne(t,"class","p-1"),ne(T,"class","p-1"),ne(r,"class","h-24 w-full border-none flex flex-col justify-center text-lg font-azeret text-center"),ne(l,"class",O="relative flex justify-center bg-black text-red-600 border-[10px] "+o[2])},m(b,E){Q(b,l,E),I(l,r),I(r,t),I(t,c),I(t,i),I(t,_),I(t,d),I(t,A),I(r,P),I(r,T),I(T,p)},p(b,E){E&2&&Xt(i,b[1]),E&10&&f!==(f=b[3].ErrorCodeKey(b[1])+"")&&Xt(d,f),E&16&&Xt(p,b[4]),E&4&&O!==(O="relative flex justify-center bg-black text-red-600 border-[10px] "+b[2])&&ne(l,"class",O)},d(b){b&&m(l)}}}function ms(o){let l,r=o[0]&&ns(o);return{c(){r&&r.c(),l=Xe()},l(t){r&&r.l(t),l=Xe()},m(t,c){r&&r.m(t,c),Q(t,l,c)},p(t,[c]){t[0]?r?r.p(t,c):(r=ns(t),r.c(),r.m(l.parentNode,l)):r&&(r.d(1),r=null)},i:pr,o:pr,d(t){r&&r.d(t),t&&m(l)}}}function Ns(o,l,r){let t,c,i,_,f,d;a(o,Ts,T=>r(1,i=T)),a(o,ie,T=>r(7,_=T)),a(o,Sr,T=>r(3,f=T)),a(o,As,T=>r(4,d=T));let A=!1,P=!0;return o.$$.update=()=>{o.$$.dirty&128&&r(6,t=_!=null),o.$$.dirty&99&&i&&t&&!A&&(r(0,A=!0),setInterval(()=>{r(5,P=!P)},800)),o.$$.dirty&32&&r(2,c=P?"border-red-600":"border-black")},[A,i,c,f,d,P,t,_]}class Is extends He{constructor(l){super(),Fe(this,l,Ns,ms,Be,{})}}function hs(o,l,r){let t,c,i,_,f,d,A,P,T,p,O,b,E,S,D,C,R,k,U,V,h,_e,le,Se,B,X,Me,fe,K,pe,j,w,W,Z,v,x,z,be,J,Oe,Ee,De,Y,$,de,Pe,q,ee,Ce,ke,Re,me,u,g,Te,et,Ne,tt,rt,ot,st,at,nt,ct,ut,gt,it,_t,lt,St,Mt,ft,pt,Ot,Et,Dt,Ie,dt,Rt,he,Tt,At,Le,bt,Pt,Ct,kt,mt,Nt,te,It,ht,ye,Lt,yt,Gt,Ut,Vt,wt,Wt,xt,N,Ht,Ft,Bt,H,Kt,jt,zt,Jt,Yt,qt,Qt,Ge,Ue;a(o,ie,e=>r(8,t=e)),a(o,Er,e=>r(9,c=e)),a(o,Dr,e=>r(10,i=e)),a(o,dr,e=>r(11,_=e)),a(o,vt,e=>r(12,f=e)),a(o,Rr,e=>r(13,d=e)),a(o,Tr,e=>r(14,A=e)),a(o,Ar,e=>r(15,P=e)),a(o,br,e=>r(16,T=e)),a(o,Pr,e=>r(17,p=e)),a(o,xe,e=>r(18,O=e)),a(o,Cr,e=>r(19,b=e)),a(o,kr,e=>r(20,E=e)),a(o,mr,e=>r(21,S=e)),a(o,Nr,e=>r(22,D=e)),a(o,Ir,e=>r(23,C=e)),a(o,hr,e=>r(24,R=e)),a(o,Lr,e=>r(25,k=e)),a(o,yr,e=>r(26,U=e)),a(o,Gr,e=>r(27,V=e)),a(o,Ur,e=>r(28,h=e)),a(o,Vr,e=>r(29,_e=e)),a(o,wr,e=>r(30,le=e)),a(o,Wr,e=>r(31,Se=e)),a(o,xr,e=>r(32,B=e)),a(o,$t,e=>r(33,X=e)),a(o,Hr,e=>r(34,Me=e)),a(o,Fr,e=>r(35,fe=e)),a(o,er,e=>r(36,K=e)),a(o,Br,e=>r(37,pe=e)),a(o,Kr,e=>r(38,j=e)),a(o,Mr,e=>r(39,w=e)),a(o,tr,e=>r(40,W=e)),a(o,jr,e=>r(41,Z=e)),a(o,zr,e=>r(42,v=e)),a(o,rr,e=>r(43,x=e)),a(o,Jr,e=>r(44,z=e)),a(o,Yr,e=>r(45,be=e)),a(o,or,e=>r(46,J=e)),a(o,qr,e=>r(47,Oe=e)),a(o,Qr,e=>r(48,Ee=e)),a(o,Xr,e=>r(49,De=e)),a(o,Zr,e=>r(50,Y=e)),a(o,vr,e=>r(51,$=e)),a(o,$r,e=>r(52,de=e)),a(o,eo,e=>r(53,Pe=e)),a(o,to,e=>r(54,q=e)),a(o,sr,e=>r(55,ee=e)),a(o,ro,e=>r(56,Ce=e)),a(o,oo,e=>r(57,ke=e)),a(o,so,e=>r(58,Re=e)),a(o,ao,e=>r(59,me=e)),a(o,no,e=>r(60,u=e)),a(o,co,e=>r(61,g=e)),a(o,uo,e=>r(62,Te=e)),a(o,go,e=>r(63,et=e)),a(o,ar,e=>r(64,Ne=e)),a(o,io,e=>r(65,tt=e)),a(o,_o,e=>r(66,rt=e)),a(o,lo,e=>r(67,ot=e)),a(o,So,e=>r(68,st=e)),a(o,Mo,e=>r(69,at=e)),a(o,fo,e=>r(70,nt=e)),a(o,po,e=>r(71,ct=e)),a(o,Oo,e=>r(72,ut=e)),a(o,Eo,e=>r(73,gt=e)),a(o,Do,e=>r(74,it=e)),a(o,Ro,e=>r(75,_t=e)),a(o,To,e=>r(76,lt=e)),a(o,Ao,e=>r(77,St=e)),a(o,bo,e=>r(78,Mt=e)),a(o,Po,e=>r(79,ft=e)),a(o,Co,e=>r(80,pt=e)),a(o,ko,e=>r(81,Ot=e)),a(o,mo,e=>r(82,Et=e)),a(o,No,e=>r(83,Dt=e)),a(o,nr,e=>r(84,Ie=e)),a(o,Io,e=>r(85,dt=e)),a(o,ho,e=>r(86,Rt=e)),a(o,cr,e=>r(87,he=e)),a(o,Lo,e=>r(88,Tt=e)),a(o,yo,e=>r(89,At=e)),a(o,ur,e=>r(90,Le=e)),a(o,Go,e=>r(91,bt=e)),a(o,Uo,e=>r(92,Pt=e)),a(o,Vo,e=>r(93,Ct=e)),a(o,wo,e=>r(94,kt=e)),a(o,Wo,e=>r(95,mt=e)),a(o,xo,e=>r(96,Nt=e)),a(o,Qe,e=>r(97,te=e)),a(o,Ho,e=>r(98,It=e)),a(o,Fo,e=>r(99,ht=e)),a(o,gr,e=>r(100,ye=e)),a(o,Bo,e=>r(101,Lt=e)),a(o,Ko,e=>r(102,yt=e)),a(o,jo,e=>r(103,Gt=e)),a(o,zo,e=>r(104,Ut=e)),a(o,Jo,e=>r(105,Vt=e)),a(o,lr,e=>r(106,wt=e)),a(o,Yo,e=>r(107,Wt=e)),a(o,qo,e=>r(108,xt=e)),a(o,$e,e=>r(109,N=e)),a(o,Qo,e=>r(110,Ht=e)),a(o,Xo,e=>r(111,Ft=e)),a(o,Zo,e=>r(112,Bt=e)),a(o,vo,e=>r(113,H=e)),a(o,$o,e=>r(114,Kt=e)),a(o,es,e=>r(115,jt=e)),a(o,ts,e=>r(116,zt=e)),a(o,Sr,e=>r(117,Jt=e)),a(o,_r,e=>r(118,Yt=e)),a(o,rs,e=>r(119,qt=e)),a(o,os,e=>r(120,Qt=e)),a(o,ss,e=>r(121,Ge=e)),a(o,ir,e=>r(122,Ue=e)),us(()=>{console.log("Proxy: onMount()"),s(ie,t.processMsg=Ms,t)});async function gs(e){await w.setup();try{console.log("Showcase:",e.title),N.powerOff(),console.log("Installing Rom:",e.roms),t.installRoms(e.roms),console.log("Configuring CHIP:",e.memory[0]),N.configure(t.OPT_CHIP_RAM,e.memory[0]),console.log("Configuring SLOW:",e.memory[1]),N.configure(t.OPT_SLOW_RAM,e.memory[1]),console.log("Configuring FAST:",e.memory[2]),N.configure(t.OPT_FAST_RAM,e.memory[2]);for(let M=0;M<e.adf.length;M++)console.log("Inserting disk "+M+":",e.adf[M]),await Ke(e.adf[M],M);console.log("Configuring warp mode: "+e.warp),O.set(n.WARP_MODE,e.warp),N.run(),e.title=="Absolute Inebriation"&&(console.log("Scheduling disk change (inebriation)"),Ge.scheduleGUITimerAbs(3e3,1)),e.title=="Eon"&&(console.log("Scheduling disk change (eon)"),Ge.scheduleGUITimerAbs(7600,2))}catch(M){throw console.log("CATCHED "+M),M}}function fr(){console.error("Exception "+N.errorCode()+": "+N.what())}async function Ke(e,M){try{console.log("Fetching adf/"+e);let re=await(await fetch("adf/"+e)).arrayBuffer(),oe=new Uint8Array(re);console.log("Calling $amiga.insertDisk",oe,M),N.insertDisk(oe,re.byteLength,M),console.log("Disk inserted")}catch{fr()}}async function je(e){if(e==0)return H.deleteRom(),H.deleteExt(),s(ir,Ue=e,Ue),!0;try{const M=await Ae.roms.get(e);return M?(M!=null&&M.rom?(H.loadRom(M.rom,M.rom.length),s(ir,Ue=e,Ue)):H.deleteRom(),M!=null&&M.ext?H.loadExt(M.ext,M.ext.length):H.deleteExt(),!0):!1}catch{return!1}}async function is(e){for(const M of e){if(console.log("Trying to install ROM",M),await je(M))return console.log("SUCCESS."),!0;console.log("FAILED.")}return!1}async function _s(){await je(as.Aros)}async function ls(){await je(as.DiagROM)}function Ss(){console.log("Creating proxies..."),s(ss,Ge=new t.AgnusProxy,Ge),s($e,N=new t.AmigaProxy,N),s(os,Qt=new t.CPUProxy,Qt),s(rs,qt=new t.DeniseProxy,qt),s(_r,Yt=new t.DiskControllerProxy,Yt),s(Sr,Jt=new t.EnumProxy,Jt),s(ts,zt=new t.JoystickProxy(1),zt),s(es,jt=new t.JoystickProxy(2),jt),s($o,Kt=new t.KeyboardProxy,Kt),s(vo,H=new t.MemoryProxy,H),s(Zo,Bt=new t.MouseProxy(1),Bt),s(Xo,Ft=new t.MouseProxy(2),Ft),s(Qo,Ht=new t.RetroShellProxy,Ht),console.log("Configuring the emulator..."),N.configure(t.OPT_AGNUS_REVISION,t.AGNUS_ECS_2MB),s(qo,xt={ArrowLeft:t.PULL_LEFT,ArrowRight:t.PULL_RIGHT,ArrowUp:t.PULL_UP,ArrowDown:t.PULL_DOWN,ControlRight:t.PRESS_FIRE,Space:t.PRESS_FIRE},xt),s(Yo,Wt={KeyS:t.PULL_LEFT,KeyD:t.PULL_RIGHT,KeyE:t.PULL_UP,KeyX:t.PULL_DOWN,KeyC:t.RELEASE_FIRE},Wt),(async()=>{console.log("Installing Roms...");const e=[3304125791,2798523958,3283989056,1062194186];t.installRoms(e),console.log("Initialization completed"),s(lr,wt=!0,wt)})()}function Ms(e,M,F,re,oe){switch(e){case t.MSG_NONE:s(Jo,Vt++,Vt);break;case t.MSG_REGISTER:s(zo,Ut++,Ut);break;case t.MSG_CONFIG:s(jo,Gt++,Gt);break;case t.MSG_POWER_ON:s(Ko,yt++,yt),s(gr,ye=!0,ye);break;case t.MSG_POWER_OFF:s(Bo,Lt++,Lt),s(gr,ye=!1,ye),s(Qe,te=!1,te);break;case t.MSG_RUN:s(Fo,ht++,ht),s(Qe,te=!0,te);break;case t.MSG_PAUSE:s(Ho,It++,It),s(Qe,te=!1,te);break;case t.MSG_STEP:s(xo,Nt++,Nt);break;case t.MSG_RESET:s(Wo,mt++,mt),O.updateWarpState(),s(ar,Ne=!1,Ne);break;case t.MSG_SHUTDOWN:s(wo,kt++,kt);break;case t.MSG_ABORT:s(Vo,Ct++,Ct);break;case t.MSG_WARP_ON:s(Uo,Pt++,Pt),s(ur,Le=!0,Le);break;case t.MSG_WARP_OFF:s(Go,bt++,bt),s(ur,Le=!1,Le);break;case t.MSG_DEBUG_ON:s(yo,At++,At),console.log("debug mode on"),s(cr,he=!0,he);break;case t.MSG_DEBUG_OFF:s(Lo,Tt++,Tt),console.log("debug mode off"),s(cr,he=!1,he);break;case t.MSG_MUTE_ON:s(ho,Rt++,Rt),s(nr,Ie=!0,Ie);break;case t.MSG_MUTE_OFF:s(Io,dt++,dt),s(nr,Ie=!1,Ie);break;case t.MSG_POWER_LED_ON:s(No,Dt++,Dt);break;case t.MSG_POWER_LED_DIM:s(mo,Et++,Et);break;case t.MSG_POWER_LED_OFF:s(ko,Ot++,Ot);break;case t.MSG_CLOSE_CONSOLE:s(Co,pt++,pt);break;case t.MSG_UPDATE_CONSOLE:s(Po,ft++,ft);break;case t.MSG_SCRIPT_DONE:s(bo,Mt++,Mt);break;case t.MSG_SCRIPT_PAUSE:s(Ao,St++,St);break;case t.MSG_SCRIPT_ABORT:s(To,lt++,lt);break;case t.MSG_SCRIPT_WAKEUP:s(Ro,_t++,_t);break;case t.MSG_VIDEO_FORMAT:s(Do,it++,it);break;case t.MSG_OVERCLOCKING:s(Eo,gt++,gt);break;case t.MSG_BREAKPOINT_REACHED:s(Oo,ut++,ut);break;case t.MSG_BREAKPOINT_UPDATED:s(po,ct++,ct);break;case t.MSG_WATCHPOINT_REACHED:s(fo,nt++,nt);break;case t.MSG_WATCHPOINT_UPDATED:s(Mo,at++,at);break;case t.MSG_CATCHPOINT_REACHED:s(So,st++,st);break;case t.MSG_CATCHPOINT_UPDATED:s(lo,ot++,ot);break;case t.MSG_SWTRAP_REACHED:s(_o,rt++,rt);break;case t.MSG_CPU_HALT:s(io,tt++,tt),s(ar,Ne=!0,Ne);break;case t.MSG_COPPERBP_REACHED:s(go,et++,et);break;case t.MSG_COPPERBP_UPDATED:s(uo,Te++,Te);break;case t.MSG_COPPERWP_REACHED:s(co,g++,g);break;case t.MSG_COPPERWP_UPDATED:s(no,u++,u);break;case t.MSG_VIEWPORT:s(ao,me++,me);break;case t.MSG_MEM_LAYOUT:s(so,Re++,Re);break;case t.MSG_DRIVE_CONNECT:s(oo,ke++,ke),s(sr,ee[M]=!0,ee);break;case t.MSG_DRIVE_DISCONNECT:s(ro,Ce++,Ce),s(sr,ee[M]=!1,ee);break;case t.MSG_DRIVE_SELECT:s(to,q++,q);break;case t.MSG_DRIVE_READ:s(eo,Pe++,Pe);break;case t.MSG_DRIVE_WRITE:s($r,de++,de),s(vr,$[M]=F==1,$);break;case t.MSG_DRIVE_LED_ON:s(Zr,Y++,Y);break;case t.MSG_DRIVE_LED_OFF:s(Xr,De++,De);break;case t.MSG_DRIVE_MOTOR_ON:s(Qr,Ee++,Ee),s(or,J[M]=!0,J),O.updateWarpState();break;case t.MSG_DRIVE_MOTOR_OFF:s(qr,Oe++,Oe),s(or,J[M]=!1,J),O.updateWarpState();break;case t.MSG_DRIVE_STEP:s(Yr,be++,be),s(rr,x[M]=F,x),w.playStepSound(re,oe);break;case t.MSG_DRIVE_POLL:s(Jr,z++,z),s(rr,x[M]=F,x),w.playStepSound(re,oe);break;case t.MSG_DISK_INSERT:s(zr,v++,v),s(tr,W[M]=!0,W),w.playInsertSound(re,oe);break;case t.MSG_DISK_EJECT:s(jr,Z++,Z),s(tr,W[M]=!1,W),w.playEjectSound(re,oe);break;case t.MSG_DISK_SAVED:s(Kr,j++,j),s(er,K[M]=!1,K);break;case t.MSG_DISK_UNSAVED:s(Br,pe++,pe),s(er,K[M]=!0,K);break;case t.MSG_DISK_PROTECT:s(Fr,fe++,fe),s($t,X[M]=!0,X);break;case t.MSG_DISK_UNPROTECT:s(Hr,Me++,Me),s($t,X[M]=!1,X);break;case t.MSG_HDC_CONNECT:s(xr,B++,B);break;case t.MSG_HDC_DISCONNECT:s(Wr,Se++,Se);break;case t.MSG_HDC_STATE:s(wr,le++,le);break;case t.MSG_HDR_STEP:s(Vr,_e++,_e);break;case t.MSG_HDR_READ:s(Ur,h++,h);break;case t.MSG_HDR_WRITE:s(Gr,V++,V);break;case t.MSG_HDR_IDLE:s(yr,U++,U);break;case t.MSG_CTRL_AMIGA_AMIGA:s(Lr,k++,k);break;case t.MSG_SHAKING:console.log("MSG_SHAKING"),s(hr,R++,R);break;case t.MSG_SER_IN:s(Ir,C++,C);break;case t.MSG_SER_OUT:s(Nr,D++,D);break;case t.MSG_AUTO_SNAPSHOT_TAKEN:s(mr,S++,S);break;case t.MSG_USER_SNAPSHOT_TAKEN:s(kr,E++,E);break;case t.MSG_SNAPSHOT_RESTORED:s(Cr,b++,b),O.updateWarpState();break;case t.MSG_RECORDING_STARTED:s(Pr,p++,p);break;case t.MSG_RECORDING_STOPPED:s(br,T++,T);break;case t.MSG_RECORDING_ABORTED:s(Ar,P++,P);break;case t.MSG_DMA_DEBUG_ON:s(Tr,A++,A),s(vt,f=!0,f);break;case t.MSG_DMA_DEBUG_OFF:s(Rr,d++,d),s(vt,f=!1,f);break;case t.MSG_SRV_STATE:s(dr,_++,_);break;case t.MSG_SRV_RECEIVE:s(Dr,i++,i);break;case t.MSG_SRV_SEND:s(Er,c++,c);break;case t.MSG_GUI_EVENT:console.log("MSG_GUI_EVENT received: ",M,F),F==1&&(console.log("Inserting disk 2..."),Ke("AbsoluteInebriation2.adf",0)),F==2&&(console.log("Inserting disk 2..."),Ke("Eon2.adf",0));break}}return[gs,fr,Ke,je,is,_s,ls,Ss]}class Ls extends He{constructor(l){super(),Fe(this,l,hs,null,Be,{runShowcase:0,reportException:1,insert:2,installRom:3,installRoms:4,installAros:5,installDiagRom:6,onRuntimeInitialized:7},null,[-1,-1,-1,-1])}get runShowcase(){return this.$$.ctx[0]}get reportException(){return this.$$.ctx[1]}get insert(){return this.$$.ctx[2]}get installRom(){return this.$$.ctx[3]}get installRoms(){return this.$$.ctx[4]}get installAros(){return this.$$.ctx[5]}get installDiagRom(){return this.$$.ctx[6]}get onRuntimeInitialized(){return this.$$.ctx[7]}}function cs(o){let l,r,t,c,i;return{c(){l=ce("script"),r=se("console.log('Loading vAmiga.js');"),t=Ze(),c=ce("script"),this.h()},l(_){l=ue(_,"SCRIPT",{});var f=ge(l);r=ae(f,"console.log('Loading vAmiga.js');"),f.forEach(m),t=ve(_),c=ue(_,"SCRIPT",{src:!0});var d=ge(c);d.forEach(m),this.h()},h(){ds(c.src,i="vAmiga.js")||ne(c,"src",i)},m(_,f){Q(_,l,f),I(l,r),Q(_,t,f),Q(_,c,f)},d(_){_&&m(l),_&&m(t),_&&m(c)}}}function ys(o){let l,r,t,c,i,_,f,d,A,P={};l=new Ls({props:P}),o[6](l);let T={};r=new Ps({props:T}),o[7](r);let p={};t=new ks({props:p}),o[8](t);let O=o[0]&&cs();_=new Is({});const b=o[5].default,E=fs(b,o,o[4],null);return{c(){ze(l.$$.fragment),ze(r.$$.fragment),ze(t.$$.fragment),O&&O.c(),c=Xe(),i=Ze(),ze(_.$$.fragment),f=Ze(),d=ce("div"),E&&E.c(),this.h()},l(S){const D=ps("svelte-16x0bsf",document.head);Je(l.$$.fragment,D),Je(r.$$.fragment,D),Je(t.$$.fragment,D),O&&O.l(D),c=Xe(),D.forEach(m),i=ve(S),Je(_.$$.fragment,S),f=ve(S),d=ue(S,"DIV",{class:!0});var C=ge(d);E&&E.l(C),C.forEach(m),this.h()},h(){ne(d,"class","relative")},m(S,D){Ye(l,document.head,null),Ye(r,document.head,null),Ye(t,document.head,null),O&&O.m(document.head,null),I(document.head,c),Q(S,i,D),Ye(_,S,D),Q(S,f,D),Q(S,d,D),E&&E.m(d,null),A=!0},p(S,[D]){const C={};l.$set(C);const R={};r.$set(R);const k={};t.$set(k),S[0]?O||(O=cs(),O.c(),O.m(c.parentNode,c)):O&&(O.d(1),O=null),E&&E.p&&(!A||D&16)&&Os(E,b,S,S[4],A?Ds(b,S[4],D,null):Es(S[4]),null)},i(S){A||(Ve(l.$$.fragment,S),Ve(r.$$.fragment,S),Ve(t.$$.fragment,S),Ve(_.$$.fragment,S),Ve(E,S),A=!0)},o(S){we(l.$$.fragment,S),we(r.$$.fragment,S),we(t.$$.fragment,S),we(_.$$.fragment,S),we(E,S),A=!1},d(S){o[6](null),qe(l),o[7](null),qe(r),o[8](null),qe(t),O&&O.d(S),m(c),S&&m(i),qe(_,S),S&&m(f),S&&m(d),E&&E.d(S)}}}function Gs(o,l,r){let t,c,i;a(o,ie,p=>r(1,t=p)),a(o,Mr,p=>r(2,c=p)),a(o,xe,p=>r(3,i=p));let{$$slots:_={},$$scope:f}=l,d=!1;us(()=>{console.log("+layout: onMount()"),window.Module=t,r(0,d=!0)});function A(p){Zt[p?"unshift":"push"](()=>{t=p,ie.set(t)})}function P(p){Zt[p?"unshift":"push"](()=>{c=p,Mr.set(c)})}function T(p){Zt[p?"unshift":"push"](()=>{i=p,xe.set(i)})}return o.$$set=p=>{"$$scope"in p&&r(4,f=p.$$scope)},[d,t,c,i,f,_,A,P,T]}class ws extends He{constructor(l){super(),Fe(this,l,Gs,ys,Be,{})}}export{ws as default};
